{% extends 'MyCpMobileFrontendBundle::base.html.twig' %}
{% block title %}
{{"CART" | trans}}
{% endblock %}

{% set main_tab = 5 %}
{% block content_nav_top_body %}
{{"CART_DESCRIPTION" | trans}}
{% endblock %}
{% block body %}
    <div class="space space-10"></div>
<div class="container">
    <div class="row">
        <div class="col-xs-2">
            <img width="100%" src="{{ asset('bundles/frontend/img/icons/cart-full.gif') }}" alt="{{"Cart" | trans}}"/>
        </div>
        <div class="col-xs-10">
            <h1 class="caecilia-roman h-grey m-a-0 f-s-24"> {{ 'CART_OF_RESERVES'|trans }} <br/></h1>
            <div style="font-size: 12px; margin-top: -3px" class="h-grey-2">{{ 'MANAGE_CART'|trans }}</div>
        </div>
        <div class="col-xs-12">
            {%if countItems > 0%}
                <a href="{{ path('frontend_empty_cart') }}" class="btn pull-right btn-danger"><i class="icon-trash icon-white"></i> {{"EMPTY_CART"|trans}}</a>
            {%endif%}
        </div>
        <div id="res_main_cont" class="col-xs-12">
            {% if countItems > 0 %}
                <div id="cart-cont" class="items-cart">
                    {{ render(controller('FrontEndBundle:Cart:getCartBody',{'flag':'false'})) }}
                </div>

            {% else %}
                <div style="margin: 10px" class="alert alert-info">{{"EMPTY_LIST"|trans}}</div>
            {% endif %}
        </div>
        <input style="visibility:hidden;" type="text" value="" name="data_reservation" id="data_reservation"/>
        <div class="container margin-t-t">
            <div class="row">
                <div class="col-xs-3 p-r-0"><a href="{{ path('my_cp_mobile_search_ownership',{'text':'null', 'arrival':'null','departure':'null','guests':'1', 'rooms':'1'})}}" class="btn btn-block btn-info p-5"><i class="ion-ios-search-strong f-s-30"></i></a></div>
                {% if countItems > 0 %}
                    <div class="col-xs-9">
                        <button type="submit" class="btn btn-block btn-primary f-s-16 p-a-1">
                            <i class="icon-question-sign"></i> {{"RESERVATION_CHECK_AVAILABILITY"|trans}}
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>
        </form>
    </div>
</div>
    <!-- Modal -->
    <div class="modal fade" id="confirmation_modal">
        <div class="modal-dialog" style="margin-top: 10%">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    {{"REMOVE_RESERVATION_CONFIRM"|trans}}
                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn">{{"CANCEL"|trans}}</button>
                    <button id="delete_button" data="" class="btn btn-primary">{{"REMOVE"|trans}}</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dalog -->
    </div><!-- /.modal -->

{% endblock %}
{% block javascripts %}
    <script type="text/javascript">
        initDelete();
        $('#delete_button').click(function(){
            string_url="{{ path('frontend_remove_from_cart_callback',{'data':0})}}";
            data_remove=$(this).attr('data');
            $('.btn_delete').attr('disabled','disable');
            string_url=string_url.substr(0,string_url.length -1);
            string_url = string_url + data_remove;
            $('#'+$(this).attr('btn_launch')).attr('class','in_process');
            $('#confirmation_modal').modal('hide');
            $.ajax({
                type: "POST",
                url: string_url,
                data: "data="+data_remove,
                success: function(msg){
                    $('.btn_delete').removeAttr('disabled');
                    if(msg=='0')
                    {
                        window.location='{{path('frontend_view_cart')}}';
                    }
                    else
                    {
                        $('#cart-cont').html(msg);
                        initDelete();
                    }
                    $(".content_table:contains('no_data_cont')").parent().parent().parent().parent().css('display','none');
                }
            });
        });

        function initDelete(){
            $('.content_table').each(function(){

                if($(this).children("table").length==0)
                {
                    $(this).parent().parent().remove();
                }
            });
            $('.btn_delete').click(function(){
                $('#confirmation_modal').modal('show');
                $('#delete_button').attr('data',$(this).attr('data'));
                $('#delete_button').attr('btn_launch',$(this).attr('id'));
            });
        }
    </script>
{% endblock %}
