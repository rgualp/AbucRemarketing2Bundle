<div class="row-fluid" id="divMessageContainer">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#new_message" data-toggle="tab">Nuevo mensaje al cliente</a>
        </li>
        <li class="">
            <a href="#client_messages" data-toggle="tab">Mensajes al cliente</a>
        </li>
        <li class="">
            <a href="#comment" data-toggle="tab">Comentarios</a>
        </li>
    </ul>
    <div class="tab-content" id="senMessageDiv" data-url="{{path("mycp_send_message")}}">
        <div id="new_message" class="tab-pane fade in active">
            <div class="row-fluid"><b>DE:</b> MyCasaParticular</div>
            <div class="row-fluid"><b>PARA:</b> {{userTourist.userTouristUser.UserUserName}} {{userTourist.userTouristUser.UserLastName}}</div>
            <div class="row-fluid" style="vertical-align: middle"><b>ASUNTO:</b> <input type="text" id="messageSubject" style="width: 91%"/></div>
            <div class="row-fluid">
                <textarea class="textarea" id="messageBody" style="width: 97%"></textarea></div>
            <div class="row-fluid">
                <em>
                    A este cliente debe escribirle en <b>{{userTourist.userTouristLanguage.langName}}</b>.<br/>
                    El correo llegará al cliente como si se hubiese escrito desde <b>reservation@mycasaparticular.com</b>.<br/>
                    <b>Nota de redacción: </b> Escriba en un lenguaje cordial y respetuoso al cliente.
                    El correo llegará en forma de plantilla de correo MyCasa con el texto que usted ha introducido por tanto le corresponde saludar y despedirse del cliente.
                </em></div>

                <button id="bSendMessage" class="btn pull-right btn-success">Enviar mensaje</button>
            <img id="loadingImg" class="pull-right hidden" src="{{asset("bundles/mycp/images/loading.gif")}}" style="margin-right: 5px;"/>
            <input type="hidden" id="userId" value="{{userTourist.userTouristUser.userId}}"/>
            <input type="hidden" id="touristId" value="{{userTourist.userTouristId}}"/>
        </div>
        <div id="client_messages" class="tab-pane fade">
            {%if messages%}
                <table class="table table-striped table-hover" style="font-size: 12px;">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Enviado Por</th>
                            <th>Mensaje</th>
                        </tr>
                    </thead>
                {%for message in messages%}
                    <tr>
                        <td>{{message.messageDate | date("d/m/Y H:i")}}</td>
                        <td>{{message.messageSender.userUserName}} {{message.messageSender.userLastName}}</td>
                        <td style="width: 70%"><b>Asunto: </b>{{message.messageSubject}}. <b>Mensaje: </b>{{message.messageBody | striptags}}</td>
                    </tr>
                {%endfor%}
                </table>
            {%else%}
                <p> <div class="alert alert-block">No se han enviado mensajes a este cliente.</div></p>
            {%endif%}
            </div>
            <div id="comment" class="tab-pane fade">

            </div>
        </div>
    </div>
    <script src="{{ asset('bundles/mycp/js/wysihtml5-0.3.0.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        var url_css_color = "{{ asset('bundles/mycp/css/wysiwyg-color.css') }}";
        </script>
        <script src="{{ asset('bundles/mycp/js/bootstrap-wysihtml5.js') }}" type="text/javascript"></script>
        <link href="{{ asset('bundles/mycp/css/bootstrap-wysihtml5.css') }}" rel="stylesheet" type="text/css" />
        <script type="text/javascript">
        $('.textarea').wysihtml5();

        $("#bSendMessage").click(function() {
            var userId = $("#userId").val();
            var touristId = $("#touristId").val();
            var subject = $("#messageSubject").val();
            var messageBody = $("#messageBody").val();
            var url = $("#senMessageDiv").attr("data-url");

            $("#loadingImg").removeClass("hidden");

            $.post(url, {
                userId: userId,
                touristId: touristId,
                subject: subject,
                messageBody: messageBody
            },
            function(data)
            {
                $("#divMessageContainer").html(data);
                $("#messageSubject").val("");
                $("#messageBody").val("");
                $("#loadingImg").addClass("hidden");
            });
            return false;
        });
   </script>