{% extends 'mycpBundle:layout:backend.html.twig' %}
{% block title %}Administración{% endblock %}
{% block another_in_head %}
    {% stylesheets
    '@mycpBundle/Resources/public/css/datepicker.css'
    filter='?uglifycss'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}
{% block top_body %}
<ul class="breadcrumb">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li class="active">Ranking</li>
</ul>
{% endblock %}
{% block content %}
<h2>Detalles del ranking</h2>
<hr/>
<br/>

<div class="tab-content" id="myTabContent">
<div id="accommodations" class="tab-pane fade active in">
    <h4>Período: {{ data.startDate | date("M, Y") }}</h4>
    <h4>Alojamiento: {{ data.accommodation.ownMcpCode }} - {{ data.accommodation.ownName }}</h4>
    <hr/>
    <div class="row-fluid">
        <div class="span4">
            <h5>Lugar general: {{ data.place }}</h5>
        </div>
        <div class="span4">
            <h5>Destino: {{ (data.accommodation.ownDestination != null) ? data.accommodation.ownDestination.desName: " - " }}</h5>
        </div>
        <div class="span4">
            <h5>Lugar en el destino: {{ data.destinationPlace }}</h5>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="#reservas" data-toggle="tab">Variables</a>
                </li>
            </ul>
            {% set index = 0 %}
            <table class="table table-striped" style="font-size: 12px; width: 100%">
                <tr>
                    <td></td>
                    <td style="width: 60%"><b>Variable</b></td>
                    <td style="text-align: center"><b>Valor</b></td>
                    <td style="text-align: center"><b>Puntos</b></td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Freq Actualización Calendario (FAD)</td>
                    <td style="text-align: center">{{ data.fad }}</td>
                    <td style="text-align: center">{{ data.fad * data.rankingPoints.fad }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Reserva Rápida (RR)</td>
                    <td style="text-align: center">{{ data.rr }}</td>
                    <td style="text-align: center">{{ data.rr * data.rankingPoints.rr }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Reserva Inmediata (RI)</td>
                    <td style="text-align: center">{{ data.ri }}</td>
                    <td style="text-align: center">{{ data.ri * data.rankingPoints.ri }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Solicitudes Disponibles (SD)</td>
                    <td style="text-align: center">{{ data.sd }}</td>
                    <td style="text-align: center">{{ data.sd * data.rankingPoints.sd }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Solicitudes No Disponibles (SND)</td>
                    <td style="text-align: center">{{ data.snd }}</td>
                    <td style="text-align: center">{{ data.snd * data.rankingPoints.snd }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Comentarios Positivos (PC)</td>
                    <td style="text-align: center">{{ data.positiveComments }}</td>
                    <td style="text-align: center">{{ data.positiveComments * data.rankingPoints.positiveComments }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Comentarios Negativos (PN)</td>
                    <td style="text-align: center">{{ data.negativeComments }}</td>
                    <td style="text-align: center">{{ data.negativeComments * data.rankingPoints.negativeComments }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Premios (P)</td>
                    <td style="text-align: center">{{ data.awards }}</td>
                    <td style="text-align: center">{{ data.awards * data.rankingPoints.awards }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Confianza (C)</td>
                    <td style="text-align: center">{{ data.confidence }}</td>
                    <td style="text-align: center">{{ data.confidence * data.rankingPoints.confidence }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Nuevas Ofertas Reservadas (NOR)</td>
                    <td style="text-align: center">{{ data.newOffersReserved }}</td>
                    <td style="text-align: center">{{ data.newOffersReserved * data.rankingPoints.newOffers }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Fallos de Casa (FC)</td>
                    <td style="text-align: center">{{ data.failureCasa }}</td>
                    <td style="text-align: center">{{ data.failureCasa * data.rankingPoints.failureCasa }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Fallos de Clientes (FC)</td>
                    <td style="text-align: center">{{ data.failureClients}}</td>
                    <td style="text-align: center">{{ data.failureClients * data.rankingPoints.failureClients }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Penalizaciones (P)</td>
                    <td style="text-align: center">{{ data.penalties}}</td>
                    <td style="text-align: center">{{ data.penalties * data.rankingPoints.penalties }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Reservaciones (R)</td>
                    <td style="text-align: center">{{ data.reservations}}</td>
                    <td style="text-align: center">{{ data.reservations * data.rankingPoints.reservations }}</td>
                </tr>
                <tr>
                    <td>{% set index = index + 1 %}{{ index }}.</td>
                    <td style="width: 60%">Facturación (F)</td>
                    <td style="text-align: center">{{ data.facturation}}</td>
                    <td style="text-align: center">{{ data.facturation * data.rankingPoints.facturation }}</td>
                </tr>
                <tr>
                    <td></td>
                    <td style="width: 60%"><h5>Puntos Totales</h5></td>
                    <td style="text-align: center"></td>
                    <td style="text-align: center"><h5>{{ data.ranking}}</h5></td>
                </tr>
            </table>
        </div>
        <div class="span6">
            <ul class="nav nav-tabs">
                <li class="active">
                    <a href="#reservas" data-toggle="tab">Totales</a>
                </li>
            </ul>
            {% set index = 0 %}
            <table class="table table-striped" style="font-size: 12px; width: 100%">
                <tr>
                    <td style="width: 60%"><b>Elemento</b></td>
                    <td style="text-align: right"><b>Valor</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Categoría</td>
                    <td style="text-align: right"><b style="font-size: larger">{{ data.category.translations[0].nomLangDescription }}</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Puntos</td>
                    <td style="text-align: right"><b style="font-size: larger">{{ data.ranking }} puntos</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Facturación del Mes</td>
                    <td style="text-align: right"><b>{{ data.currentMonthFacturation }} CUC</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Facturación Total</td>
                    <td style="text-align: right"><b>{{ data.totalFacturation }} CUC</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Total Habitaciones Disponibles</td>
                    <td style="text-align: right"><b>{{ data.totalAvailableRooms }}</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Total Habitaciones No Disponibles</td>
                    <td style="text-align: right"><b>{{ data.totalNonAvailableRooms }}</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Total de Reservas</td>
                    <td style="text-align: right"><b>{{ data.totalReservedRooms }}</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Facturación por Habitaciones Disponibles</td>
                    <td style="text-align: right"><b>{{ data.totalAvailableFacturation }} CUC</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Facturación por Habitaciones No Disponibles</td>
                    <td style="text-align: right"><b>{{ data.totalNonAvailableFacturation }} CUC</b></td>
                </tr>
                <tr>
                    <td style="width: 60%">Cantidad de Visitas</td>
                    <td style="text-align: right"><b>{{ data.visits }}</b></td>
                </tr>
            </table>
        </div>
    </div>
</div>
{% endblock %}
{% block javascripts %}
    {% javascripts
    '@mycpBundle/Resources/public/js/bootstrap-datepicker.js'
    '@mycpBundle/Resources/public/js/bootstrap-datepicker.es.js'
    '@mycpBundle/Resources/public/js/common_list.js'
    '@mycpBundle/Resources/public/js/bootstrap-typeahead.js'
    filter='?uglifyjs2'
    %}
    <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript">
        url = "{{ path('mycp_get_mun_by_prov', { 'country_code': '-1' }) }}";
        url = url.replace('/-1', '');
        $('.datepicker').datepicker({
            format: 'dd-mm-yyyy',
            todayBtn: 'linked',
            autoclose: true,
            language: 'es'
        });

        function submit_filters(ev)
        {
            if (ev.keyCode == 13)
            {
                action_submit();
            }
        }
        filter_code = $('#filter_code').val();
        function action_submit()
        {
            var filter_code = $('#filter_code').val();
            if (filter_code == '')
                filter_code = 'null';
            var filter_name = $('#filter_name').val();
            if (filter_name == '')
                filter_name = 'null';
            var filter_destination = $('#filter_destination').val();
            if (filter_destination == '')
                filter_destination = 'null';
            var filter_modality = $('#filter_modality').val();
            if (filter_modality == '')
                filter_modality = 'null';
            var filter_month = $('#filter_month').val();
            if (filter_month == '')
                filter_month = 'null';
            var filter_year = $('#filter_year').val();
            if (filter_year == '')
                filter_year = 'null';
            var filter_point_option = $('#filter_point_option').val();
            if (filter_point_option == '')
                filter_point_option = 'null';
            var filter_point_from = $('#filter_point_from').val();
            if (filter_point_from == '')
                filter_point_from = 'null';
            var filter_point_to = $('#filter_point_to').val();
            if (filter_point_to == '')
                filter_point_to = 'null';

            url_submit = $('#filter').attr('action');
            url_submit = url_submit + '/' + filter_code + '/' + filter_name + '/' + filter_destination + '/' + filter_modality + '/' + filter_month + '/' + filter_year + '/' + filter_point_option + '/' + filter_point_from + '/' + filter_point_to;
            $('#filter').attr('action', url_submit);
            $('#filter').submit();
        }
    </script>
{% endblock %}