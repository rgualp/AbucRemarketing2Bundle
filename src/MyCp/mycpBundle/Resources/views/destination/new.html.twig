{% extends 'mycpBundle:layout:backend.html.twig' %}
{% block title %}Administración{% endblock %}
{% block top_body %}
<ul class="breadcrumb">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li><a href="{{ path('mycp_list_destination') }}">Destinos</a> <span class="divider">/</span></li>
    {% if data['edit_destination'] is defined %}
    <li class="active">Editar destino</li>
    {% else %}
    <li class="active">Adicionar destino</li>
    {% endif %}
    <li class="pull-right"><a href="{{ path('mycp_list_destination') }}"><i class="icon-hand-left"></i> Volver atrás</a></li>
</ul>
{% endblock %}
{% block form_actions %}
<ul class="breadcrumb">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li><a href="{{ path('mycp_list_destination') }}">Destinos</a> <span class="divider">/</span></li>
    {% if data['edit_destination'] is defined %}
    <li class="active">Editar destino</li>
    {% else %}
    <li class="active">Adicionar destino</li>
    {% endif %}
    <li class="pull-right"><a href="{{ path('mycp_list_destination') }}"><i class="icon-hand-left"></i> Volver atrás</a></li>
</ul>
<div class="form-actions">
    <button class="btn btn-primary" type="submit">Guardar</button>
    <a class="btn" href="{{ path('mycp_list_destination') }}">Cancelar</a>
</div>
</form>
{% endblock %}
{% block content %}
<h2>{% if data['edit_destination'] is defined %}Editar destino ({{data['name_destination']}}){% else %} Adicionar destino {% endif %}</h2>

<hr/>
{% if errors %}<label class="alert alert-error">Debe llenar el formulario correctamente.</label>{%endif%}
<form action="{{ path('mycp_new_destination')}}" method="POST">
{% if data['edit_destination'] is defined %}<input style="display: none;" name="edit_destination" value="{{data['id_destination']}}"> {% endif %}

<label>Nombre:</label>{% if errors['name'] is defined %}<label class="error">{{errors['name']|trim(':')}}</label>{%endif%}
<input class="span12" name="name" value="{% if(data['name'] is defined) %}{{data['name']}}{% endif %}" type="text"/>
    <br/>
    <h3 class="title">Descripción breve</h3>
{% for language in languages %}
    <label>{{language.lang_name |title}}:</label>
    {%if errors["brief_"~language.lang_id] is defined %}<label class="error">{{errors["brief_"~language.lang_id]|trim(':')}}</label>{%endif%}
    <textarea class="span12 textarea" name="brief_{{language.lang_id}}">{%if data["brief_"~language.lang_id] is defined %}{{data["brief_"~language.lang_id]}}{%endif%}</textarea><br/>
{% endfor %}
    <h3 class="title">Descripción</h3>
    {% for language in languages %}
    <label>{{language.lang_name |title}}:</label>
    {%if errors["desc_"~language.lang_id] is defined %}<label class="error">{{errors["desc_"~language.lang_id]|trim(':')}}</label>{%endif%}
    <textarea class="span12 textarea" id="desc_{{language.lang_id}}" name="desc_{{language.lang_id}}">{%if data["desc_"~language.lang_id] is defined %}{{data["desc_"~language.lang_id]}}{%endif%}</textarea><br/>
    {% endfor %}
    <h3 class="title">Ubicación</h3>
    {%if errors["ownership_address_province"] is defined %}<label class="error">{{errors["ownership_address_province"]|trim(':')}}</label>{%endif%}
    <div class="row-fluid">
    <div class="span6">
        <label>Provincia:</label>
        <select class="input-block-level" name="ownership_address_province" id="ownership_address_province"/>
        {% render 'mycpBundle:Public:get_provinces' with{'post':data} %}
        </select>
    </div>
    <div class="span6">
        <label>Municipio:</label>
        <select class="input-block-level" name="ownership_address_municipality" id="ownership_address_municipality"/>
        {% render 'mycpBundle:Public:get_mun' with{'post':data}%}
        </select>
    </div>
    </div>
    <h3 class="title">Publicado</h3>
    <label class="checkbox">
        <input type="checkbox" {% if(data['public'] is defined) %} checked="TRUE" {% endif %} name="public"> Publicado en el sitio
    </label>
    <script src="{{ asset('bundles/mycp/js/wysihtml5-0.3.0.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        var url_css_color="{{ asset('bundles/mycp/css/wysiwyg-color.css') }}";
    </script>
    <script src="{{ asset('bundles/mycp/js/bootstrap-wysihtml5.js') }}" type="text/javascript"></script>
    <link href="{{ asset('bundles/mycp/css/bootstrap-wysihtml5.css') }}" rel="stylesheet" type="text/css" />
    <script type="text/javascript">
        $('.textarea').wysihtml5();
        url = "{{ path('mycp_get_mun_by_prov', { 'country_code': '' }) }}",
                $('#ownership_address_province').change(function(){
                    code = $('#ownership_address_province').val();
                    if(code!='')
                    {
                        $('#ownership_address_municipality').html('<option value="">Cargando...</option>');


                        $.ajax({
                            type:"POST",
                            url:url + '/' + code,
                            success:function (msg) {

                                $('#ownership_address_municipality').html(msg);
                            }
                        });
                    }
                });

    </script>

{% endblock %}
