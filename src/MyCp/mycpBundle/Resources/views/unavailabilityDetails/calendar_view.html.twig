{% extends 'mycpBundle:layout:lodging.html.twig' %}
{% block title %}Administración{% endblock %}
{% block another_in_head %}
    <link href='{{ asset('bundles/mycp/css/fullcalendar.min.css') }}' rel='stylesheet'
          xmlns="http://www.w3.org/1999/html"/>
    <link href='{{ asset('bundles/mycp/css/fullcalendar.print.css') }}' rel='stylesheet' media='print' />
{% endblock %}
{% block top_body %}
    <ul class="breadcrumb">
        <li><a href="{{path('mycp_lodging_front')}}">Administración</a> <span class="divider">/</span></li>
        <li class="active">Disponibilidad</li>
    </ul>
{% endblock %}
{% block content %}
    <div class="row-fluid">
        <div class="span3"><h2>Disponibilidad</h2></div>
        <div id="loading" class="span9">
                <img src="{{ asset('bundles/mycp/images/ajax-loader-7.gif') }}">
            </div>
    </div>


<hr/>

    <div id="calendar-div" class="row-fluid">
        <div class="span8">
        <div id='calendar' class="row_fluid"></div>
        <div class="row_fluid" style="text-align: right;padding-top: 3px">
        <div style="text-align: center; width:100px; display:inline;" class="badge badge-success">No disponible</div>
        <div style="text-align: center; width:100px; display:inline;" class="badge badge-important">Reservada MyCP</div>
        <div style="text-align: center; width:120px; display:inline;" class="badge badge-info">Cancelada por cliente</div>
    </div>
        </div>
        <div class="span4">
        <h4>Gestionar disponibilidad</h4>
        <form class="sfgen" {{form_enctype(form)}} method="POST" action="" novalidate="true">
        {{form_widget(form)}}
          <div class="row-fluid">
              <label class="required">Estado</label>
              <select name="status" id="status" style="width:100%" required="required">
                  <option></option>
                  <option value="0" {% if edit_detail is defined %}selected="true"{%endif%}>No disponible</option>
                  {% if edit_detail is defined %}
                  <option value="1">Disponible</option>
                  {%endif%}
              </select>
          </div>
        <div>
          <button class="btn btn-primary" type="submit">Guardar</button>
          <a class="btn" href="{{path('mycp_lodging_unavailabilityDetails_calendar')}}">Cancelar</a>
          {% if edit_detail is defined %} <a class="btn btn-danger" href="{{path('mycp_lodging_delete_unavailabilityDetails', {'id_detail':edit_detail})}}">Eliminar</a> {% endif %}
        </div>
        </form>
        </div>
    </div>



    <div class="modal hide fade" id="modal-warning">
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">×</button>
            <h3>Error</h3>
        </div>
        <div class="modal-body">
            Se ha producido un error cuando se cargaban los detalles de no disponibilidad.
        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-danger" data-dismiss="modal">Cerrar</a>
        </div>
    </div>

    <script src='{{ asset('bundles/mycp/js/moment.min.js') }}'></script>
    <script src='{{ asset('bundles/mycp/js/fullcalendar.min.js') }}'></script>
    <script src='{{ asset('bundles/mycp/js/fullcalendar-lang-all.js') }}'></script>
    <link href="{{ asset('bundles/mycp/css/datepicker.css') }}" rel="stylesheet" type="text/css" />
    <script src="{{ asset('bundles/mycp/js/bootstrap-datepicker.js') }}" type="text/javascript"></script>
    <script type="text/javascript" src="{{ asset('bundles/mycp/js/bootstrap-datepicker.es.js') }}" charset="UTF-8"></script>

    <script>

        $(document).ready(function() {

            loadRooms();

            $('.datepicker-from').datepicker({
            format:'dd/mm/yyyy',
            todayBtn:'linked',
            language:'es',
            autoclose: true
        }).on('changeDate', function(ev){
            var date = new Date(ev.date);
            date.setDate(date.getDate() + 1);
            datepicker_to.setStartDate(date);
            datepicker_to.setDate(date);
        });

    var datepicker_to = $('.datepicker-to').datepicker({
        format:'dd/mm/yyyy',
        todayBtn:'linked',
        autoclose: true,
        language: 'es'
    }).data('datepicker');

            $('#calendar').fullCalendar({
                header: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'month,agendaWeek'
                },
                defaultDate: '{{ data.today | date("Y-m-d") }}',
                editable: false,
                lang: 'es',
                eventLimit: true, // allow "more" link when too many events
                events: {
                    url: '{{ path('mycp_lodging_unavailabilityDetails_get_json') }}',
                    error: function() {
                        $('#modal-warning').show();
                    }
                },
                loading: function(bool) {
                    if (bool)
                    {
                        $('#loading').show();

                    }
                    else
                    {
                        $('#loading').hide();


                    }
                }
            });

        });

    </script>
    <script type="text/javascript">
        function go_to_form()
        {
            id_own = $("#ownership_id").val();
            id_room = $("#room_id").val();

            if (id_own == "" || id_room == "")
            {
                alert('Debe seleccionar una propiedad y una habitación');
            }
            else
            {
                url='{{ path('mycp_lodging_new_unavailabilityDetails', {'id_room':'-1'}) }}';
                url=url.replace('/-1','');
                $(location).attr('href',url+id_room);
            }
        }

        $('#ownership_id').change(function(){
            loadRooms();
        });

        function loadRooms()
        {
            $('#room_id').html('<option value="">Cargando...</option>');
            code = $('#ownership_id').val();
            url = '{{ path('mycp_get_rooms_by_ownership', {'id_ownership':'-1'}) }}';
            url=url.replace('/-1','');
            $.ajax({
                type:"POST",
                url:url + '/' + code,
                success:function (msg) {
                    $('#room_id').html(msg);
                }
            });
        }

    </script>
{% endblock content %}