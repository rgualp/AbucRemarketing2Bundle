{% extends 'mycpBundle:layout:backend.html.twig' %}
{% block title %}Administración{% endblock %}
{% block top_body %}
<ul class="breadcrumb">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li><a href="{{ path('mycp_list_users') }}">Usuarios</a> <span class="divider">/</span></li>
    <li class="active">{%if(edit_user is defined)%}Editar usuario{%else%}Adicionar usuario{%endif%} client_casa</li>
    <li class="pull-right"><a href="{{ path('mycp_list_users') }}"><i class="icon-hand-left"></i> Volver atrás</a></li>
</ul>
{% endblock %}
{% block form_actions %}
<div class="form-actions">
    <button class="btn btn-primary" type="submit">Guardar</button>
    <a class="btn" href="{{ path('mycp_list_users') }}">Cancelar</a>
</div>
</form>
{% endblock %}
{% block content %}
<h2>{%if(edit_user is defined)%}Editar usuario{%else%}Adicionar usuario{%endif%} client_casa</h2>
<hr/>
{% if data['error'] is defined %}<div class="alert alert-error">{{data['error']}}</div>{%endif%}
<form class="sfgen" {{form_enctype(form)}} method="POST" action="{% if edit_user is defined%}{{ path('mycp_edit_user_casa',{'id_user':edit_user}) }}{% else %}{{ path('mycp_new_user_casa',{'id_role':id_role})}}{% endif %}" novalidate="true">
    <div class="row-fluid">
        <div class="span3">{{form_row(form.photo)}}</div>
        <div class="span3">{{form_row(form.ownership)}}</div>
        <div class="span3">{{form_row(form.name)}}</div>
        <div class="span3">{{form_row(form.last_name)}}</div>
    </div>
    <div class="row-fluid">
        <div class="span6">{{form_row(form.email)}}</div>
        <div class="span6">{{form_row(form.address)}}</div>
    </div>
    <div class="row-fluid">
        <div class="span4">{{form_row(form.user_name)}}</div>
        <div class="span4">{{form_row(form.user_password['Clave:'])}}</div>
        <div class="span4">{{form_row(form.user_password['Repetir_clave:'])}}</div>
    </div>
    {% if edit_user is not defined%}
    <br/>
    <div class="row-fluid">
        <div class="span12">
            <button class="btn btn-info pull-right"><i class="icon-envelope icon-white"></i> Notificar al cliente</button>
        </div>
    </div>
    <br/>
    {% endif %}
    {{form_rest(form)}}
    <script type="text/javascript">
        $('.sfgen input').addClass('input-block-level')
        $('.sfgen select').addClass('input-block-level')
    </script>
    <script src="{{ asset('bundles/mycp/js/bootstrap-fileinput.js') }}" type="text/javascript"></script>
    {% if edit_user is not defined %}
    <script type="text/javascript">
        array_own={};
        {% for ownership in data['ownerships'] %}
        array_own[{{ ownership.getOwnId }}]=["{{ ownership.getOwnHomeowner1 }}","{{ ownership.getOwnEmail1 }}","{{ ownership.getOwnAddressStreet }} # {{ ownership.getOwnAddressNumber }}, {{ ownership.getOwnAddressMunicipality }}, {{ ownership.getOwnAddressProvince}}"];
        {% endfor %}
        $('.ownership').change(function(){
            id_own=$('.ownership').val();
            if(id_own!='')
            {
                name=array_own[id_own][0];
                name_array=name.split(' ');
                name=name_array[0];
                last_name='';
                for(a=1;a < name_array.length;a++)
                {
                    last_name+=' '+name_array[a]
                }
                $('.name').val(name);
                if(last_name)
                    $('.last_name').val(last_name);
                else
                    $('.last_name').val(name);
                email1=array_own[id_own][1];
                $('.email').val(email1);
                address=array_own[id_own][2];
                $('.address').val(address);
            }
        })
        $("input.readonly").attr('readonly',true);
    </script>
    {% endif %}
{% endblock %}
