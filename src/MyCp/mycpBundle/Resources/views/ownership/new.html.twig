{% extends 'mycpBundle:layout:backend.html.twig' %}
{% block title %}Administración{% endblock %}
{% block another_in_head %}
    {% stylesheets
    '@mycpBundle/Resources/public/css/datepicker.css'
    '@mycpBundle/Resources/public/css/bootstrap-wysihtml5.css'
    '@mycpBundle/Resources/public/css/validations.css'
    filter='?uglifycss'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
{% endblock %}
{% block top_body %}
<ul class="breadcrumb" xmlns="http://www.w3.org/1999/html">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li><a href="{{ path('mycp_list_ownerships') }}">Propiedades</a> <span class="divider">/</span></li>
    {% if data['edit_ownership'] is defined %}
    <li class="active">Editar {{data['ownership_mcp_code']}}</li>
    {% else %}
    <li class="active">Adicionar propiedad</li>
    {% endif %}
    <li class="pull-right"><a href="{{ path('mycp_list_ownerships') }}"><i class="icon-hand-left"></i> Volver atrás</a></li>
</ul>
{% endblock %}
{% block form_actions %}

<ul class="breadcrumb" xmlns="http://www.w3.org/1999/html">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li><a href="{{ path('mycp_list_ownerships') }}">Propiedades</a> <span class="divider">/</span></li>
    {% if data['edit_ownership'] is defined %}
    <li class="active">Editar {{data['ownership_mcp_code']}}</li>
    {% else %}
    <li class="active">Adicionar propiedad</li>
    {% endif %}
    <li class="pull-right"><a href="{{ path('mycp_list_ownerships') }}"><i class="icon-hand-left"></i> Volver atrás</a></li>

</ul>
<div class="form-actions">
<div class="btn-toolbar" role="toolbar">
    <div class="btn-group dropup">
        <button type="button" class="btn btn-success" onclick="javascript:submit_button({{constant('\\MyCp\\mycpBundle\\Helpers\\Operations::SAVE')}})">Guardar</button>
        <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
            <span class="sr-only"></span>
        </button>
        <ul class="dropdown-menu pull-right" role="menu">
            <li><a style="cursor: hand" onclick="javascript:submit_button({{constant('\\MyCp\\mycpBundle\\Helpers\\Operations::SAVE_AND_ADD_PHOTOS')}})">Guardar y agregar fotos</a></li>
            <li><a style="cursor: hand" onclick="javascript:submit_button({{constant('\\MyCp\\mycpBundle\\Helpers\\Operations::SAVE_AND_NEW')}})">Guardar y agregar nuevo</a></li>
            <li><a style="cursor: hand" onclick="javascript:submit_button({{constant('\\MyCp\\mycpBundle\\Helpers\\Operations::SAVE_AND_EXIT')}})">Guardar e ir al listado</a></li>
        </ul>
        </div>

    <div class="btn-group dropup">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
           Acciones <span class="caret"></span>
            <span class="sr-only"></span>
        </button>
        <ul class="dropdown-menu pull-right" role="menu">
            {% if(data['edit_ownership'] is defined or post['ownership_id'] is defined) or (post['ownership_email_1'] is defined and post['ownership_email_1'] != "") or (post['ownership_email_2'] is defined and post['ownership_email_2'] != "") %}
            {% if(post['ownership_id'] is defined) %}
            <li><a href="{{ path('mycp_list_photos_ownership',{'id_ownership':post['ownership_id']}) }}">Ver fotos</a></li>
            {% if is_granted('ROLE_CLIENT_STAFF')  and data['ownership_mcp_code'] != null and data['ownership_mcp_code'] != ""%}
            <li><a href="{{path("mycp_download_zip_photo", {"idOwnership": post['ownership_id'], "ownMycpCode": data['ownership_mcp_code']})}}"><i class="icon-download-alt"></i> Descargar Fotos</a></li>
            {%endif%}
             <li><a href="{{ path('mycp_list_penalties',{'accommodationId':post['ownership_id']}) }}">Penalizaciones</a></li>
             <li><a href="{{ path('mycp_list_touristfailures',{'accommodationId':post['ownership_id']}) }}">Fallos de turistas</a></li>
            {%if (post['ownership_email_1'] is defined and post['ownership_email_1'] != "") or (post['ownership_email_2'] is defined and post['ownership_email_2'] != "")%}
            <li class="divider"></li>
            <li><a style="cursor: hand" onclick="send_message();">Enviar Correo de Instrucciones</a></li>
            {%endif%}
            {%endif%}
            {% if data['edit_ownership'] is defined %}
            {% if(post['ownership_id'] is defined) %}
                <li class="divider"></li>
            {%endif%}
                <li><a href="{{ path('mycp_edit_ownership', {"id_ownership": data['edit_ownership']}) }}">Eliminar últimos cambios</a></li>
            {% endif %}
            <li class="divider"></li>
            {% endif %}
            <li><a href="{{ path('mycp_new_ownership') }}">Insertar nueva propiedad</a></li>
        </ul>
        </div>


    <a class="btn" href="{{ path('mycp_list_ownerships') }}">Cancelar</a>
    </div>
    </div>
</div>
</form>
{% endblock %}
{% block content %}
<script type="text/javascript">
        var count_rooms = 1;
</script>
<h2>{% if data['edit_ownership'] is defined %}{{data['ownership_mcp_code']}} - {{data['name_ownership']}}
    {% if data['status_id'] is defined and data['status_id']%}
    {% if data['status_id']== constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')%}<span class="label label-success vertical_middle" title="Estado Activo">Activo</span>{% else %} <span class="label label-important vertical_middle" title="Estado {{ data['status_name'] }}">{{ data['status_name'] }}</span>{% endif %}
    {%else%}
    <span class="label vertical_middle" title="Sin estado">Sin estado</span>
    {% endif %}
    {%if data['top_20'] is defined and  data['top_20']%}
    <span class="label label-warning vertical_middle" title="Top 20">Top 20</span>
    {%endif%}
    {%if data['selection'] is defined and  data['selection']%}
    <span class="label label-info vertical_middle" title="Casa Selección">Casa Selección</span>
    {%endif%}
    {%if data['inmediate_booking'] is defined and  data['inmediate_booking']%}
    <span class="label label-important vertical_middle" title="Reserva Rápida"><i class="glyphicons electricity white"></i> Reserva Rápida</span>
    {%endif%}
    {%if data['inmediate_booking_2'] is defined and  data['inmediate_booking_2']%}
        <span class="label vertical_middle" style="color: #fff; background-color: #ff0000;" title="Reserva Inmediata"><i class="fa fa-rocket"></i> Reserva Inmediata</span>
    {%endif%}
    {%if data['not_recommendable'] is defined and data['not_recommendable']%}
    <span class="label label-important vertical_middle" title="No recomendables">No recomendable</span>
    {%endif%}
    {%if data['cubacoupon'] is defined and  data['cubacoupon']%}
        <span class="label label-info vertical_middle" title="Trabaja con CubaCoupon">CubaCoupon</span>
    {%endif%}

    {% else %} Adicionar propiedad {% endif %}</h2>
<hr/>
{% for message in app.session.flashbag.get('message_error_local') %}
<div class="alert alert-error">{{ message }}</div>
{% endfor %}
<form id="form_ownership" action="{{ path('mycp_new_ownership')}}" method="POST" enctype="multipart/form-data">

    <input id="save_operation" name="save_operation" value="{{constant('\\MyCp\\mycpBundle\\Helpers\\Operations::SAVE_AND_EXIT')}}" class="hidden">
        {% if data['edit_ownership'] is defined %}<input style="display: none;" name="edit_ownership" value="{{data['id_ownership']}}"> {% endif %}
            {% if data['count_errors']>0 %}<label class="alert alert-error">Debe llenar el formulario correctamente.</label>{%endif%}
            <ul class="nav nav-tabs" id="myTab">
                <li class="active"><a id="tabGeneral" {% if errors_tab['general_tab'] is defined %} class="tab_errors" {% endif %} data-toggle="tab" href="#generales">Datos generales</a></li>
                <li class=""><a {% if errors_tab['room_tab'] is defined %} class="tab_errors" {% endif %} data-toggle="tab" href="#habitaciones">Habitaciones</a></li>
                <li class=""><a data-toggle="tab" href="#facilidades">Facilidades</a></li>
                <li class=""><a {% if errors_tab['house_tab'] is defined %} class="tab_errors" {% endif %} data-toggle="tab" href="#casa">Casa</a></li>
                <li class=""><a data-toggle="tab" href="#sales">Ventas</a></li>
                <li class=""><a {% if errors_tab['user_tab'] is defined %} class="tab_errors" {% endif %} data-toggle="tab" href="#usuario">Usuario</a></li>
                {% if data['edit_ownership'] is defined %}
                <li class=""><a data-toggle="tab" href="#comentarios">Comentarios</a></li>
                {% endif %}
            </ul>
            <div class="tab-content" id="myTabContent">
                <div id="generales" class="tab-pane fade active in">
                    <div class="row-fluid">
                        <div class="span6">
                            <label>Nombre de la casa (*)</label>
                            {% if errors['ownership_name'] is defined %} <label class="error" id="errorName">{{errors['ownership_name']|trim(':')}}</label>{% endif %}
                            <input value="{% if(post['ownership_name'] is defined) %}{{post['ownership_name']}}{% endif %}" class="input-block-level" type="text" name="ownership_name"/>
                        </div>
                        <div class="span3">
                            <label>No. de licencia </label>
                            {% if errors['ownership_licence_number'] is defined %}<label class="error">{{errors['ownership_licence_number']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_licence_number'] is defined) %}{{post['ownership_licence_number']}}{% endif %}" class="input-block-level" type="text" name="ownership_licence_number"/>
                        </div>
                        <div class="span3">
                            <label>Código MCP (*)</label>
                            {{ data['ownership_mcp_code'] }}
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <label>Calle (*)</label>
                            {% if errors['ownership_address_street'] is defined %}<label class="error">{{errors['ownership_address_street']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_address_street'] is defined) %}{{post['ownership_address_street']}}{% endif %}" class="input-block-level" type="text"  name="ownership_address_street"/>
                        </div>
                        <div class="span2">
                            <label>No. (*)</label>
                            {% if errors['ownership_address_number'] is defined %}<label class="error">{{errors['ownership_address_number']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_address_number'] is defined) %}{{post['ownership_address_number']}}{% endif %}" class="input-block-level" type="text" name="ownership_address_number"/>
                        </div>
                        <div class="span3">
                            <label>Entre calle...</label>
                            {% if errors['ownership_address_between_street_1'] is defined %}<label class="error">{{errors['ownership_address_between_street_1']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_address_between_street_1'] is defined) %}{{post['ownership_address_between_street_1']}}{% endif %}" class="input-block-level" type="text" name="ownership_address_between_street_1"/>
                        </div>
                        <div class="span3">
                            <label>Y...</label>
                            {% if errors['ownership_address_between_street_2'] is defined %}<label class="error">{{errors['ownership_address_between_street_2']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_address_between_street_2'] is defined) %}{{post['ownership_address_between_street_2']}}{% endif %}" class="input-block-level" type="text" name="ownership_address_between_street_2"/>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span4">
                            <label>Provincia (*)</label>
                            {% if errors['ownership_address_province'] is defined %}<label class="error">{{errors['ownership_address_province']|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="ownership_address_province" id="ownership_address_province"/>
                            {{ render(controller('mycpBundle:Public:get_provinces', {'post': post})) }}
                            </select>
                        </div>
                        <div class="span4">
                            <label>Municipio (*)</label>
                            {% if errors['ownership_address_municipality'] is defined %}<label class="error">{{errors['ownership_address_municipality']|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" type="text" name="ownership_address_municipality" id="ownership_address_municipality">
                                {{ render(controller('mycpBundle:Public:get_mun_by_prov', {'post':post})) }}
                            </select>
                        </div>
                        <div class="span4">
                            <label>Destino</label>
                            {% if errors['ownership_destination'] is defined %}<label class="error">{{errors['ownership_destination']|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" type="text" name="ownership_destination" id="ownership_destination">
                                {{ render(controller('mycpBundle:Public:getDestinationByMun', {'post':post})) }}
                            </select>
                        </div>

                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label>Nombre del propietario (1) (*)</label>
                            {% if errors['ownership_homeowner_1'] is defined %}<label class="error">{{errors['ownership_homeowner_1']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_homeowner_1'] is defined) %}{{post['ownership_homeowner_1']}}{% endif %}" class="input-block-level" type="text" name="ownership_homeowner_1"/>
                        </div>
                        <div class="span6">
                            <label>Nombre del propietario (2)</label>
                            {% if errors['ownership_homeowner_2'] is defined %}<label class="error">{{errors['ownership_homeowner_2']|trim(':')}}</label>{%endif%}
                            <input  value="{% if(post['ownership_homeowner_2'] is defined) %}{{post['ownership_homeowner_2']}}{% endif %}" class="input-block-level" type="text" name="ownership_homeowner_2"/>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <label>Teléfono móvil</label>
                            {% if errors['ownership_mobile_number'] is defined %}<label class="error">{{errors['ownership_mobile_number']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_mobile_number'] is defined) %}{{post['ownership_mobile_number']}}{% endif %}" class="input-block-level" type="text" name="ownership_mobile_number"/>
                        </div>
                        <div class="span3">
                            <label>Teléfono</label>
                            {% if errors['ownership_phone_number'] is defined %}<label class="error">{{errors['ownership_phone_number']|trim(':')}}</label>{%endif%}
                            <div class="row-fluid">
                                <div id="province_code" class="span5">{% if(post['ownership_phone_code'] is defined) %}{{post['ownership_phone_code']}}{% else %}---{% endif %}</div>
                                <div class="span7"><input value="{% if(post['ownership_phone_number'] is defined) %}{{post['ownership_phone_number']}}{% endif %}" class="input-block-level" type="text" name="ownership_phone_number"/></div>
                                <input class="hidden" name="ownership_phone_code" id="ownership_phone_code" value="{% if(post['ownership_phone_code'] is defined) %}{{post['ownership_phone_code']}}{% endif %}"/>
                            </div>
                        </div>
                        <div class="span3">
                            <label>E-mail (1)</label>
                            {% if errors['ownership_email_1'] is defined %}<label class="error">{{errors['ownership_email_1']|trim(':')}}</label>{%endif%}
                            {% if errors['ownership_email_1_email'] is defined %}<label class="error">{{errors['ownership_email_1_email']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_email_1'] is defined) %}{{post['ownership_email_1']}}{% endif %}" class="input-block-level" type="text" name="ownership_email_1"/>
                        </div>
                        <div class="span3">
                            <label>E-mail (2)</label>
                            {% if errors['ownership_email_2'] is defined %}<label class="error">{{errors['ownership_email_2']|trim(':')}}</label>{%endif%}
                            {% if errors['ownership_email_2_email'] is defined %}<label class="error">{{errors['ownership_email_2_email']|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['ownership_email_2'] is defined) %}{{post['ownership_email_2']}}{% endif %}" class="input-block-level" type="text" name="ownership_email_2"/>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <label>Categoría de la casa (*)</label>
                            {% if errors['ownership_category'] is defined %}<label class="error">{{errors['ownership_category']|trim(':')}}</label>{%endif%}
                            <select name="ownership_category" class="input-block-level">
                                {{ render(controller('mycpBundle:BackendOwnership:get_ownership_categories', {'post': post})) }}
                            </select>
                        </div>
                        <div class="span3">
                            <label>Tipo de propiedad (*)</label>
                            {% if errors['ownership_type'] is defined %}<label class="error">{{errors['ownership_type']|trim(':')}}</label>{%endif%}
                            <select name="ownership_type" class="input-block-level">
                                {{ render(controller('mycpBundle:BackendOwnership:get_ownership_types', {'post': post})) }}
                            </select>
                        </div>
                        <div class="span6">
                            <label>Idiomas (*)</label>
                            <div class="row-fluid">
                                <div class="span3">
                                    <label><input {% if post['ownership_english_lang'] is defined %} checked="checked" {% endif %} type="checkbox" name="ownership_english_lang"/> Inglés</label>
                                </div>
                                <div class="span3">
                                    <label><input {% if post['ownership_french_lang'] is defined %} checked="checked" {% endif %} type="checkbox" name="ownership_french_lang"/> Francés</label>
                                </div>
                                <div class="span3">
                                    <label><input {% if post['ownership_german_lang'] is defined %} checked="checked" {% endif %} type="checkbox" name="ownership_german_lang"/> Alemán</label>
                                </div>
                                <div class="span3">
                                    <label><input {% if post['ownership_italian_lang'] is defined %} checked="checked" {% endif %} type="checkbox" name="ownership_italian_lang"/> Italiano</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span6">
                            <label>Comisión (*)</label>
                                {% if errors['ownership_percent_commission'] is defined %}<label class="error">{{errors['ownership_percent_commission']|trim(':')}}</label>{%endif%}
                                <select name="ownership_percent_commission" class="input-block-level">
                                    {% if post['ownership_percent_commission'] is defined %}
                                    {{ render(controller('mycpBundle:BackendReservation:get_percent_list', {'post':{'percent':post['ownership_percent_commission']}})) }}
                                    {% else %}
                                    {{ render(controller('mycpBundle:BackendReservation:get_percent_list', {'post':''})) }}
                                    {% endif %}
                                </select>
                        </div>
                        <div class="span6">
                            <label>Tiene fotos buenas?</label>
                             <label><input {% if post['good_picture'] is defined and post['good_picture'] == true %} checked="checked" {% endif %} type="checkbox" name="goodPicture"/> Si</label>
                        </div>
                    </div>
                </div>
                <div id="habitaciones" class="tab-pane fade">
                    <div class="row-fluid">
                        <div class="span12">
                            <a href="javascript:add_room()" class="btn"><i class="icon-plus"></i> Adicionar habitación</a>
                            <input style="display: none;" name="count_rooms" id="count_rooms" value="{{count_rooms}}"/>
                            <input id="new_room" type="hidden" name="new_room" value=""/>
                        </div>
                    </div>
                    <br/>
                    <div class="row-fluid" style="width:{{ 210 * count_rooms}}px" id="rooms">
                        {% for i in 1..count_rooms %}
                        <div class="span1" style="width: 200px; margin-left: 0px!important; margin-right: 10px;">
                            {% if data['edit_ownership'] is defined and post['room_id_'~i] is defined%}<input name="room_id_{{i}}" value="{{post['room_id_'~i]}}" type="hidden"/>{%endif%}
                            <label><span class="label label-info">Habitación # {{i}}</span>
                            <input type="hidden" name="room_active_{{ i }}" value="{%if post['room_active_'~i] is defined%}{{post['room_active_'~i]}}{% else %}0{% endif %}"/>
                            {%if post['room_active_'~i] is defined%}
                                  {%if post['room_active_'~i]%}
                                  <span class="label label-success">Activa</span>
                                {%else%}
                                  <span class="label label-warning">Inactiva</span>
                                {%endif%}
                              {%endif%}
                              {%if post['room_ical_url_'~i] is defined%}
                              <input type="hidden" name="room_ical_url_{{ i }}" value="{{post['room_ical_url_'~i]}}"/>
                              <a class="btn btn-mini btn-info" href="{{post['room_ical_url_'~i]}}" title="Descargar calendario (.ics)"><i class="icon-calendar"></i></a>
                              {%endif%}
                            </label>
                            <label>Tipo de habitación (*)</label>
                            {% if errors['room_type_'~i] is defined %}<label class="error">{{errors['room_type_'~i]|trim(':')}}</label>{%endif%}
                            <select name="room_type_{{i}}" id="room_type_{{i}}" class="input-block-level">
                                {{ render(controller('mycpBundle:BackendOwnership:get_room_type_list', {'post':post,'id':i})) }}
                            </select>
                            <label>No. de camas (*)</label>
                            {% if errors['room_beds_number_'~i] is defined %}<label class="error">{{errors['room_beds_number_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_beds_number_{{ i }}" id="room_beds_number_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_range_max_5', {'post':post,'id':i})) }}
                            </select>
                            <label>Precio (Temporada baja) (*)</label>
                            {% if errors['room_price_down_to_'~i] is defined %}<label class="error">{{errors['room_price_down_to_'~i]|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['room_price_down_to_'~i] is defined) %}{{post['room_price_down_to_'~i]}}{% endif %}" class="input-block-level" placeholder="Precio único" type="text" name="room_price_down_to_{{ i }}" id="room_price_down_to_{{ i }}"/>
                            <label>Precio (Temporada alta) (*)</label>
                            {% if errors['room_price_up_to_'~i] is defined %}<label class="error">{{errors['room_price_up_to_'~i]|trim(':')}}</label>{%endif%}
                            <input value="{% if(post['room_price_up_to_'~i] is defined) %}{{post['room_price_up_to_'~i]}}{% endif %}" class="input-block-level" placeholder="Precio único" type="text" name="room_price_up_to_{{ i }}" id="room_price_up_to_{{ i }}"/>

                            <label>Precio (Temporada especial)</label>
                            {% if errors['room_price_special_'~i] is defined %}<label class="error">{{errors['room_price_special_'~i]|trim(':')}}</label>{%endif%}
                            <input disabled='disabled' value="{% if(post['room_price_special_'~i] is defined) %}{{post['room_price_special_'~i]}}{% endif %}" class="input-block-level special_season_price" placeholder="Precio único" type="text" name="room_price_special_{{ i }}" id="room_price_special_{{ i }}"/>


                            <label>Climatización (*)</label>
                            {% if errors['room_climate_'~i] is defined %}<label class="error">{{errors['room_climate_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_climate_{{ i }}" id="room_climate_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_climate_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Audiovisuales (*)</label>
                            {% if errors['room_audiovisual_'~i] is defined %}<label class="error">{{errors['room_audiovisual_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_audiovisual_{{ i }}" id="room_audiovisual_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_audiovisual_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Fumador (*)</label>
                            {% if errors['room_smoker_'~i] is defined %}<label class="error">{{errors['room_smoker_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_smoker_{{ i }}" id="room_smoker_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_smoker_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Caja fuerte (*)</label>
                            {% if errors['room_safe_box_'~i] is defined %}<label class="error">{{errors['room_safe_box_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_safe_box_{{ i }}" id="room_safe_box_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_safe_box_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Facilidades para bebés (*)</label>
                            {% if errors['room_baby_'~i] is defined %}<label class="error">{{errors['room_baby_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_baby_{{ i }}" id="room_baby_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_baby_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Tipo de baño (*)</label>
                            {% if errors['room_bathroom_'~i] is defined %}<label class="error">{{errors['room_bathroom_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_bathroom_{{ i }}" id="room_bathroom_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_bathroom_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Estereo (*)</label>
                            {% if errors['room_stereo_'~i] is defined %}<label class="error">{{errors['room_stereo_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_stereo_{{ i }}" id="room_stereo_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_stereo_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Ventana (*)</label>
                            {% if errors['room_windows_'~i] is defined %}<label class="error">{{errors['room_windows_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_windows_{{ i }}" id="room_windows_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_windows_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Balcón (*)</label>
                            {% if errors['room_balcony_'~i] is defined %}<label class="error">{{errors['room_balcony_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_balcony_{{ i }}" id="room_balcony_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_balcony_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Terraza (*)</label>
                            {% if errors['room_terrace_'~i] is defined %}<label class="error">{{errors['room_terrace_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_terrace_{{ i }}" id="room_terrace_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_terrace_list', {'post':post,'id':i})) }}
                            </select>
                            <label>Patio (*)</label>
                            {% if errors['room_yard_'~i] is defined %}<label class="error">{{errors['room_yard_'~i]|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="room_yard_{{ i }}" id="room_yard_{{ i }}">
                                {{ render(controller('mycpBundle:BackendOwnership:get_yard_list', {'post':post,'id':i})) }}
                            </select>

                            {% if post['room_id_'~i] is defined %}
                            {% if (post['room_active_'~i] is defined) %}
                                {% if post['room_active_'~i] == 0 %}
                                <a class="btn btn-success" href="{{ path('mycp_active_room', { 'id_room': post['room_id_'~i], 'activate':1 }) }}" {% if  post['room_can_active_'~i] is defined and not post['room_can_active_'~i]%}disabled="disabled"{% endif %}>Activar</a>
                                {% else %}
                                <a class="btn btn-warning" href="{{ path('mycp_active_room', { 'id_room': post['room_id_'~i], 'activate':0 }) }}">Desactivar</a>
                                {% endif %}
                            {% endif %}
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div id="facilidades" class="tab-pane fade">
                    <div class="row-fluid">
                        <div class="span3"></div>
                        <div class="span3"></div>
                        <div class="span3"><label>Precio desde</label></div>
                        <div class="span3"><label>Precio hasta</label></div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3"><label>Desayuno incluido (*)</label></div>
                        <div class="span3">{% if errors['facilities_breakfast'] is defined %}<label class="error">{{errors['facilities_breakfast']|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="facilities_breakfast">
                                {{ render(controller('mycpBundle:BackendOwnership:get_facilities_breakfast_list', {'post':post})) }}
                            </select></div>
                        <div class="span3"><label><input value="{% if(post['facilities_breakfast_price'] is defined) %}{{post['facilities_breakfast_price']}}{% endif %}" type="text" class="input-block-level" name="facilities_breakfast_price"/></label></div>
                        <div class="span3"></div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3"><label>Cena (*)</label></div>
                        <div class="span3">{% if errors['facilities_dinner'] is defined %}<label class="error">{{errors['facilities_dinner']|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="facilities_dinner">
                                {{ render(controller('mycpBundle:BackendOwnership:get_facilities_dinner_list', {'post':post})) }}
                            </select></div>
                        <div class="span3"><input placeholder="Desde" value="{% if(post['facilities_dinner_price_from'] is defined) %}{{post['facilities_dinner_price_from']}}{% endif %}" type="text" class="input-block-level" name="facilities_dinner_price_from"/></div>
                        <div class="span3"><input placeholder="Hasta" value="{% if(post['facilities_dinner_price_to'] is defined) %}{{post['facilities_dinner_price_to']}}{% endif %}" type="text" class="input-block-level" name="facilities_dinner_price_to"/></div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3"><label>Parqueo incluido (*)</label></div>
                        <div class="span3">{% if errors['facilities_parking'] is defined %}<label class="error">{{errors['facilities_parking']|trim(':')}}</label>{%endif%}
                            <select class="input-block-level" name="facilities_parking">
                                {{ render(controller('mycpBundle:BackendOwnership:get_facilities_parking_list', {'post':post})) }}
                            </select></div>
                        <div class="span3"><input value="{% if(post['facilities_parking_price'] is defined) %}{{post['facilities_parking_price']}}{% endif %}" type="text" class="input-block-level" name="facilities_parking_price"/></div>
                        <div class="span3"></div>
                    </div>
                    <div class="row-fluid">
                        <label>Notas</label>
                        <textarea class="input-block-level" name="facilities_notes">{% if(post['facilities_notes'] is defined) %}{{post['facilities_notes']}}{% endif %}</textarea>
                    </div>
                </div>
                <div id="casa" class="tab-pane fade">
                    <div class="row-fluid">
                        <div class="span3">

                            <label class="checkbox" style="float: left; margin-right: 10px;">
                                <input type="checkbox" {% if(post['water_jacuzee'] is defined and (post['water_jacuzee'] or post['water_jacuzee'] == "on")) %} checked="TRUE" {% endif %} name="water_jacuzee"/> Jacuzee
                        </label>
                        <label class="checkbox" style="float: left; margin-right: 10px;">
                            <input type="checkbox" {% if(post['water_sauna'] is defined and (post['water_sauna'] or post['water_sauna'] == "on")) %} checked="TRUE" {% endif %} name="water_sauna"/> Sauna
                    </label>
                    <label class="checkbox" style="float: left; margin-right: 10px;">
                        <input type="checkbox" {% if(post['water_piscina'] is defined and (post['water_piscina'] or post['water_piscina'] == "on")) %} checked="TRUE" {% endif %} name="water_piscina"/> Piscina
                </label>
            </div>

            <div class="span3">
                <label>Parqueo ciclos (Cajas) (*)</label>
                {% if errors['description_bicycle_parking'] is defined %}<label class="error">{{errors['description_bicycle_parking']|trim(':')}}</label>{%endif%}
                <select class="input-block-level" name="description_bicycle_parking">
                    {{ render(controller('mycpBundle:BackendOwnership:get_bicycle_list', {'post':post})) }}
                </select>
            </div>
            <div class="span2">
                <label>Mascotas (*)</label>
                {% if errors['description_pets'] is defined %}<label class="error">{{errors['description_pets']|trim(':')}}</label>{%endif%}
                <select class="input-block-level" name="description_pets">
                    {{ render(controller('mycpBundle:BackendOwnership:get_pets_list', {'post':post})) }}
                </select>
            </div>
            <div class="span2">
                <label>Lavanderia (*)</label>
                {% if errors['description_laundry'] is defined %}<label class="error">{{errors['description_laundry']|trim(':')}}</label>{%endif%}
                <select class="input-block-level" name="description_laundry">
                    {{ render(controller('mycpBundle:BackendOwnership:get_laundry_list', {'post':post})) }}
                </select>
            </div>
            <div class="span2">
                <label>Email (Internet) (*)</label>
                {% if errors['description_internet'] is defined %}<label class="error">{{errors['description_internet']|trim(':')}}</label>{%endif%}
                <select class="input-block-level" name="description_internet">
                    {{ render(controller('mycpBundle:BackendOwnership:get_internet_list', {'post':post})) }}
                </select>
            </div>

        </div>
        <h3 class="title">Descripción breve</h3>
        <div class="row-fluid">
            <div class="span12">
                {% for language in languages %}
                {% if data['edit_ownership'] is defined and post['description_id_'~language.lang_id] is defined%}<input name="description_id_{{language.lang_id}}" value="{{post['description_id_'~language.lang_id]}}" type="hidden"/>{%endif%}
                <label>{{language.lang_name |title}} (*):</label>
                {%if errors["description_brief_desc_"~language.lang_id] is defined %}<label class="error">{{errors["description_brief_desc_"~language.lang_id]|trim(':')}}</label>{%endif%}
                <textarea class="textarea span12 textarea-brief-{{ language.lang_code | lower }}" name="description_brief_desc_{{language.lang_id}}">{%if post["description_brief_desc_"~language.lang_id] is defined %}{{post["description_brief_desc_"~language.lang_id]}}{%endif%}</textarea>

                {% endfor %}
            </div>
        </div>

        <h3 class="title">Descripción</h3>
        <div class="row-fluid">
            <div class="span12">
                {% for language in languages %}
                <label>{{language.lang_name |title}} (*):</label>
                {%if errors["description_desc_"~language.lang_id] is defined %}<label class="error">{{errors["description_desc_"~language.lang_id]|trim(':')}}</label>{%endif%}
                <textarea class="textarea span12 textarea-description-{{ language.lang_code | lower }}" name="description_desc_{{language.lang_id}}">{%if post["description_desc_"~language.lang_id] is defined %}{{post["description_desc_"~language.lang_id]}}{%endif%}</textarea>
                    {% if data["description_translated_"~language.lang_id] is defined and data["description_translated_"~language.lang_id]%}
                        <br/><em><small>Traducido automáticamente por Google Translate</small></em>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <h3 class="title">Palabras claves</h3>
        <div class="row-fluid">
            <div class="span12">
                {% for language in languages %}
                {% if data['edit_ownership'] is defined and post['kw_id_'~language.lang_id] is defined%}<input name="kw_id_{{language.lang_id}}" value="{{post['kw_id_'~language.lang_id]}}" type="hidden"/>{%endif%}
                <label>{{language.lang_name |title}} (*):</label>
                {%if errors["keywords_"~language.lang_id] is defined %}<label class="error">{{errors["keywords_"~language.lang_id]|trim(':')}}</label>{%endif%}
                <input type="text" class="span12 input-keywords-{{ language.lang_code | lower }}" name="keywords_{{language.lang_id}}" value="{%if post["keywords_"~language.lang_id] is defined %}{{post["keywords_"~language.lang_id]}}{%endif%}"/>
                       {% endfor %}
        </div>
    </div>
    <h3 id="geolocation_form" class="title">Geolocalización (*)</h3>
    <div class="row-fluid">
        <div class="span6">
            {%if errors["geolocate_x"] is defined %}<label class="error">{{errors["geolocate_x"]|trim(':')}}</label>{%endif%}
            <input type="text" name="geolocate_x" class="input-block-level" value="{%if post["geolocate_x"] is defined %}{{post["geolocate_x"]}}{%endif%}"/>
    </div>
    <div class="span6">
        {%if errors["geolocate_y"] is defined %}<label class="error">{{errors["geolocate_y"]|trim(':')}}</label>{%endif%}
        <input type="text" name="geolocate_y" class="input-block-level" value="{%if post["geolocate_y"] is defined %}{{post["geolocate_y"]}}{%endif%}"/>
</div>
<div class="span6">

</div>
</div>
<h3 class="title">Top 20</h3>
<label class="checkbox">
    <input type="checkbox" {% if post['top_20'] is defined and (post['top_20'] ==1) %} checked="TRUE" {% endif %} name="top_20"> Habilitar para Top 20
</label><br/>
<h3 class="title">Casa Selección</h3>
<label class="checkbox">
    <input type="checkbox" {% if post['selection'] is defined and (post['selection'] ==1) %} checked="TRUE" {% endif %} name="selection"> Habilitar para Casa Selección
</label><br/>
<h3 class="title">Reserva Rápida</h3>
<label class="checkbox">
    <input type="checkbox" {% if post['inmediate_booking'] is defined and (post['inmediate_booking'] ==1) %} checked="TRUE" {% endif %} name="inmediate_booking"> Habilitar para Reserva Rápida
</label><br/>
<h3 class="title">Reserva Inmediata</h3>
<label class="checkbox">
    <input type="checkbox" {% if post['inmediate_booking_2'] is defined and (post['inmediate_booking_2'] ==1) %} checked="TRUE" {% endif %} name="inmediate_booking_2"> Habilitar para Reserva Inmediata
</label><br/>
{% if is_granted('ROLE_CLIENT_STAFF') %}
<h3 class="title">No Recomendable</h3>
<label class="checkbox">
    <input type="checkbox" {% if (post['not_recommendable'] is defined and (post['not_recommendable'] ==1)) %} checked="TRUE" {% endif %} name="not_recommendable"> Habilitar como NO RECOMENDABLE en su destino
</label><br/>
{%endif%}
<h3 class="title">CubaCoupon</h3>
<label class="checkbox">
    <input type="checkbox" {% if post['cubacoupon'] is defined and (post['cubacoupon'] ==1) %} checked="TRUE" {% endif %} name="cubacoupon"> Trabaja con CubaCoupon
</label><br/>

<h3 class="title">¿Es Confiable?</h3>
<label class="checkbox">
    <input type="checkbox" {% if post['confidence'] is defined and (post['confidence'] ==1) %} checked="TRUE" {% endif %} name="confidence"> Es una casa confiable para MyCasaParticular
</label><br/>

<h3 class="title">Publicado</h3>
{%if errors["status"] is defined %}<label class="error">{{errors["status"]|trim(':')}}</label>{%endif%}
<select name="status" class="input-block-level" id="status">
    {{ render(controller('mycpBundle:BackendOwnership:get_status', {'post':post})) }}
</select>
<label>Comentarios:</label>
<input type="text" class="input-block-level" name="comment" value="{%if post["comment"] is defined %}{{post["comment"]}}{%endif%}" />
</div>
<div id="sales" class="tab-pane fade">
    <div class="row-fluid">
        <div class="span6">
            <label>Gestor que visitó la casa</label>
            <input value="{% if(post['ownership_saler'] is defined) %}{{post['ownership_saler']}}{% endif %}" class="input-block-level" type="text" name="ownership_saler" autocomplete="off" type="text" class="input-block-level" style="margin: 0 auto;" data-provide="typeahead" data-items="5" data-source='{{ render(controller('mycpBundle:BackendOwnership:get_salers_names')) }}'/>
    </div>

    <div class="span6">
        <label>Fecha de Visita (dd/mm/yyyy)</label>
        {% if(data['ownership_visit_date'] is defined and data['ownership_visit_date'] != null) %}
        <label>{{data['ownership_visit_date'] | date('d/m/Y')}}</label>
        {%else%}
        <input class="input-block-level datepicker" type="text" name="ownership_visit_date"/>
        {%endif%}
    </div>
</div>
{% if data['edit_ownership'] is defined %}
<div class="row-fluid">
    <div class="span6">
        <label>Fecha de Creación</label>
        <label>{% if(data['ownership_creation_date'] is defined and data['ownership_creation_date'] != null) %}{{data['ownership_creation_date'] | date("d/m/Y, H:s")}}{%else%}(Sin definir){% endif %}</label>
    </div>

    <div class="span6">
        <label>Fecha de Última Modificación</label>
        <label>{% if(data['ownership_last_update'] is defined and data['ownership_last_update'] != null) %}{{data['ownership_last_update'] | date("d/m/Y, H:s")}}{%else%}(Sin definir){% endif %}</label>
    </div>
</div>
<div class="row-fluid">
    <div class="span6">
        <label>Fecha de Publicación</label>
        <label>{% if(data['ownership_publish_date'] is defined and data['ownership_publish_date'] != null) %}{{data['ownership_publish_date'] | date("d/m/Y, H:s")}}{%else%}(Sin definir){% endif %}</label>
    </div>
</div>
{%endif%}
</div>
<div id="usuario" class="tab-pane fade">
    <!--h3 class="title">Seleccionar usuario</h3>
    <div class="row-fluid">
        <div class="span12">
            <select id="user_selected" name="user_selected" class="input-block-level">
                {#% if data['edit_ownership'] is defined %#}
                {#{ render(controller('mycpBundle:BackendUser:getUsersCasa', {'exclude_own_id':data['id_ownership']})) }#}
                    {#%else%#}
                    {#{ render(controller('mycpBundle:BackendUser:getUsersCasa')) }#}
                    {#%endif%#}
            </select>
        </div>
    </div>
    <br/>
    <br/-->

    {%if users is defined and users%}
    {%for user in users%}
    <div class="row-fluid">
        <div class="row-fluid">
            <div class="span3">Usuario: </div> <div class="span9">{{user.usercasauser.username}}</div>
        </div>
        <div class="row-fluid">
            <div class="span3">Nombre y Apellidos: </div> <div class="span9"> {{user.usercasauser.userusername}} {{user.usercasauser.userlastname}}</div>
        </div>
        <div class="row-fluid">
            <div class="span3">Dirección: </div> <div class="span9"> {%if user.usercasauser.useraddress%}{{user.usercasauser.useraddress}}{%else%}-{%endif%}</div>
        </div>
        <div class="row-fluid">
            <div class="span3">Correo: </div> <div class="span9"> {%if user.usercasauser.useremail%}{{user.usercasauser.useremail}}{%else%}-{%endif%}</div>
        </div>
        <div class="row-fluid">
            <div class="span3">Teléfono: </div> <div class="span9"> {%if user.usercasauser.userphone%}{{user.usercasauser.userphone}}{%else%}-{%endif%}</div>
        </div>
        <div class="row-fluid">
            <div class="span3">Estado: </div> <div class="span9"> {%if user.usercasauser.userenabled%}Activo{%else%}Inactivo{%endif%}</div>
        </div>
    </div>
    <br/>
    <div class="row-fluid">
        <div class="span7">
            <a class="btn btn-mini pull-right" style="height:20px; padding-top:7px;" target="_blank" href="{{ path('mycp_edit_user_casa',{'id_user':user.usercasauser.userid})}}">Editar</a>
        </div>
        <div class="span2">
            {%if user.usercasauser.userenabled%}
            <a class="btn btn-danger pull-right" href="{{path('mycp_change_status_user',{'userId':user.usercasauser.userid})}}" {% if data['status_id']!= constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')%}disabled="disabled"{%endif%}>Desactivar</a>
            {%else%}
            <a class="btn btn-success pull-right" href="{{path('mycp_change_status_user',{'userId':user.usercasauser.userid})}}" {% if data['status_id']!= constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')%}disabled="disabled"{%endif%}>Activar</a>
            {%endif%}
        </div>
        <div class="span3">
            <a class="btn btn-info" href="{{path('mycp_send_created_usercasa_mail',{'userId':user.usercasauser.userid,'returnUrlName':'mycp_list_ownerships'})}}" {%if not user.usercasauser.useremail or data['status_id']!= constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')%}disabled="disabled"{%endif%}><i class="icon-envelope icon-white"></i> Notificar al cliente</a>
        </div>
    </div>
    <hr/>
    {%endfor%}
    {%else%}
    <div id="divCreateUserCasa" {%if data['status_id']!= constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')%} style="display:none;"{%endif%}>
    <h3 class="title">Nuevo usuario</h3>
    <div class="row-fluid">
        <input type="checkbox" name="user_create" checked id="user_create"/> Crear una cuenta de usuario para este alojamiento
        <br/>
    </div>
    <div class="row-fluid">
        <input type="checkbox" name="user_send_mail" checked id="user_send_mail" disabled="disabled"/> Enviar los datos de la cuenta al correo del propietario
    </div>
    </div>

    <div id="notUserCasaMustCreate" {%if data['status_id']!= constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')%} style="display:block;"{%else%}style="display:none;"{%endif%}>
     El estado de esta propiedad no permite que se cree una cuenta de usuario.
    </div>
    {%endif%}
    <br/>
    <h3 class="title">Configuración</h3>
    <div class="row-fluid">
        <input type="checkbox" name="sms_notification" id="sms_notification" {% if post['sms_notification'] is defined and (post['sms_notification'] ==1) %} checked="TRUE" {% endif %}/> Enviar notificaciones por SMS
    </div>
    <br/>
    <h3 class="title">Foto del propietario(a)</h3>
    <div class="photoOwnerContainer">
        <div class="photoOwnerContainer">
            {{ render(controller("mycpBundle:BackendOwnership:getOwnerPhoto", {'ownershipPhoto': data['ownership_owner'], 'ownershipId': (data['id_ownership'] is defined) ? data['id_ownership'] : null})) }}
        </div>
    </div>
</div>
{% if data['edit_ownership'] is defined %}
<div id="comentarios" class="tab-pane fade">
    {% render(controller('mycpBundle:BackendComment:get_comments_by_ownership', {'id_own':data['id_ownership']})) %}
</div>
{% endif %}
</div>
{% include 'mycpBundle:utils:confirmation_window.html.twig' with {'message':'¿Desea realizar esta acción?','confirmation_action_label':'Eliminar'}%}
{% endblock %}
    {% block javascripts %}

    {% if data['new_room'] is defined%}
        <script type="text/javascript">
            $('#myTab a[href="#habitaciones"]').tab('show');
        </script>
    {%endif%}

    <script type="text/javascript">
        var url_css_color="{{ asset('bundles/mycp/css/wysiwyg-color.css') }}";
    </script>

    {% javascripts
    '@mycpBundle/Resources/public/js/common_list.js'
    '@mycpBundle/Resources/public/js/bootstrap-datepicker.js'
    '@mycpBundle/Resources/public/js/bootstrap-datepicker.es.js'
    '@mycpBundle/Resources/public/js/bootstrap-typeahead.js'
    '@mycpBundle/Resources/public/js/wysihtml5-0.3.0.min.js'
    '@mycpBundle/Resources/public/js/bootstrap-wysihtml5.js'
    '@mycpBundle/Resources/public/js/bootstrap-fileinput.js'
    '@mycpBundle/Resources/public/js/jquery-validation-1.14.0/dist/jquery.validate.min.js'
    '@mycpBundle/Resources/public/js/jquery-validation-1.14.0/dist/localization/messages_es.min.js'
    filter='?uglifyjs2'
    %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}

    <script type="text/javascript">
        url = "{{ path('mycp_get_mun_by_prov', { 'country_code': '-1'}) }}";
        url = url.replace('/-1', '');

        url_destination = "{{ path('mycp_get_destination_by_mun') }}";

        canActivate();

        $("#user_create").change(function() {
            if (this.checked)
            {
                $("#user_send_mail").removeAttr("disabled");
            }
            else
                $("#user_send_mail").attr("disabled", "disabled");
        });

        $('.datepicker').datepicker({
            format: 'dd/mm/yyyy',
            todayBtn: 'linked',
            autoclose: true,
            language: 'es'
        });
        $('#ownership_address_province').change(function() {

            code_prov = $('#ownership_address_province option:selected').attr('class');
            $('#province_code').html('(+53) ' + code_prov);
            $('#ownership_phone_code').val('(+53)' + code_prov );

            $('#ownership_address_municipality').html('<option value="">Cargando...</option>');
            code = $('#ownership_address_province').val();
            $.ajax({
                type: "POST",
                url: url + '/' + code,
                success: function(msg) {

                    $('#ownership_address_municipality').html(msg);
                }
            });
        });

        $('#ownership_address_municipality').change(function() {

            $('#ownership_destination').html('<option value="">Cargando...</option>');
            mun = $('#ownership_address_municipality').val();
            prov = $('#ownership_address_province').val();
            $.ajax({
                type: "POST",
                url: url_destination + '/' + mun + '/' + prov,
                success: function(msg) {

                    $('#ownership_destination').html(msg);
                }
            });
        });

        setSpecialSeasonPrice();
        $('#ownership_destination').change(setSpecialSeasonPrice);

        var activeStatus = {{constant('\\MyCp\\mycpBundle\\Entity\\ownershipStatus::STATUS_ACTIVE')}};
        $('#status').change(function(){
            selected_val = $('#status').val();
            if(selected_val == activeStatus)
            {
                $("#divCreateUserCasa").css("display", "block");
                $("#notUserCasaMustCreate").css("display", "none");
            }
            else
            {
                $("#divCreateUserCasa").css("display", "none");
                $("#notUserCasaMustCreate").css("display", "block");
            }
        });

        function add_room()
        {
            $('#new_room').val('1');
            $('#form_ownership').submit();

        }

        function setSpecialSeasonPrice()
        {
            $('#ownership_destination').find("option").each(function(i) {
                if ($(this).is(":selected") && $(this).attr('data-has-season') == 1)
                {
                    $('.special_season_price').removeAttr('disabled');
                    return false;
                }
                else
                    $('.special_season_price').attr('disabled', 'disabled');
            });
        }

/*locations validate*/
        var form = $('#form_ownership');
        var validatorForm = form.validate({
            errorElement: 'span',
            errorClass: 'has-error',
            ignore: "",
            //errorLabelContainer: $("#error-container-form-user"),
            rules: {
                'geolocate_x': {
                    number: true,
                    min: 19.797717,
                    max: 23.362429
                },
                'geolocate_y': {
                   number: true,
                    min: -85.03418,
                    max: -74.003906
                }
            },
            invalidHandler: function (event, validator) {},
            highlight: function (element, clsError) { // hightlight error inputs
                element = $(element);
                element.parent().addClass(clsError);
            },
            unhighlight: function (element, clsError) { // revert the change done by hightlight
                element = $(element);
                element.parent().removeClass(clsError);
            }
        });

        function submit_button(operation)
        {
            if(!validatorForm.form()){
                console.log('Existen campos invalidos');
                $(window).scrollTop($('#geolocation_form').offset().top);
                return false;
            }
            $("#save_operation").val(operation);
            $("#form_ownership").submit();
        }

        $('input').keyup(function () {
            canActivate();
        });
        $('select').change(function () {
            canActivate();
        });

        function checkRoomsToActivate()
        {
            var notSelectedType = true;
            $('[name^="room_type_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedType = false;
                }
            });
            var notSelectedBeds = true;
            $('[name^="room_beds_number_"]').each(function () {
                if ($(this).val() !== "") {
                    notSelectedBeds = false;
                }
            });
            var notSelectedPriceDown = true;
            $('[name^="room_price_down_to_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedPriceDown = false;
                }
            });
            var notSelectedPriceTo = true;
            $('[name^="room_price_up_to_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedPriceTo = false;
                }
            });
            var notSelectedClimate = true;
            $('[name^="room_climate_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedClimate = false;
                }
            });
            var notSelectedAudiovisual = true;
            $('[name^="room_audiovisual_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedAudiovisual = false;
                }
            });
            var notSelectedBathroom = true;
            $('[name^="room_bathroom_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedBathroom = false;
                }
            });
            var notSelectedWindows = true;
            $('[name^="room_windows_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedWindows = false;
                }
            });
            var notSelectedBalcony = true;
            $('[name^="room_balcony_"]').each(function() {
                if($(this).val() !== "")
                {
                    notSelectedBalcony = false;
                }
            });

            return notSelectedType || notSelectedBeds || notSelectedPriceDown || notSelectedPriceTo || notSelectedClimate || notSelectedAudiovisual || notSelectedBathroom || notSelectedWindows || notSelectedBalcony;
        }

        function checkDescriptionsToActivate()
        {
            var notSelectedBrief = true;
            $('[name^="description_brief_desc_"]').each(function() {
                if($(this).val() !== "" || $(this).hasClass("textarea-brief-de"))
                {
                    notSelectedBrief = false;
                }
            });

            var notSelectedDescription = true;
            $('[name^="description_desc_"]').each(function() {
                if($(this).val() !== "" || $(this).hasClass("textarea-description-de"))
                {
                    notSelectedDescription = false;
                }
            });

            var notSelectedKeyword = true;
            $('[name^="keywords_"]').each(function() {
                if($(this).val() !== "" || $(this).hasClass("input-keywords-de"))
                {
                    notSelectedKeyword = false;
                }
            });

            return notSelectedBrief || notSelectedDescription || notSelectedKeyword
        }

        function canActivate()
        {
            var name = $('[name="ownership_name"]').val();
            var code = $('[name="ownership_mcp_code"]').val();
            var mainStreet = $('[name="ownership_address_street"]').val();
            var streetNumber = $('[name="ownership_address_number"]').val();
            var province = $('[name="ownership_address_province"]').val();
            var municipality = $('[name="ownership_address_municipality"]').val();
            var owner = $('[name="ownership_homeowner_1"]').val();
            var phone = $('[name="ownership_phone_number"]').val();
            var movil = $('[name="ownership_mobile_number"]').val();
            var category = $('[name="ownership_category"]').val();
            var type = $('[name="ownership_type"]').val();
            var commission = $('[name="ownership_percent_commission"]').val();
            var notSelectedRoom = checkRoomsToActivate();
            var notDescriptions = checkDescriptionsToActivate();
            var geoX = $('[name="geolocate_x"]').val();
            var geoY = $('[name="geolocate_y"]').val();

            if(name === "" || code === "" || mainStreet === "" || streetNumber === "" || province === "" || owner === "" || municipality === "" ||
                    (phone + movil === "")  || category === ""  || type === ""  || commission === "" || notSelectedRoom || notDescriptions || geoX === "" || geoY === "")
                $(".status-option-1").addClass("hidden");
            else
                $(".status-option-1").removeClass("hidden");
        }
    </script>
    <script>
        $('.textarea').wysihtml5();

        function send_message()
        {
            url_submit = "{%if post['ownership_id'] is defined%}{{path('mycp_send_ownership',{'own_id':post['ownership_id']})}}{%endif%}";
            form = $('#form_ownership');
            form.attr('action', url_submit);
            form.submit();
        }
    </script>
    <script>
        if($('#deletePhotoOwner').length) {
            var idOwnership = {{ data['id_ownership'] }};

            $('#deletePhotoOwner').click(function () {
                deletePhotoOwner();
            });

            function deletePhotoOwner() {
                var url = $("#deletePhotoOwner").attr("data-url");
                $("#loadingImg").removeClass("hidden");

                $.post(url, {
                            idOwnership: idOwnership
                        },
                        function (data) {
                            $(".photoOwnerContainer").html(data);
                            $("#loadingImg").addClass("hidden");
                        });
                return false;
            }
        }

    </script>
{% endblock %}