{% extends 'mycpBundle:layout:backend.html.twig' %}
{% block title %}Administración{% endblock %}
{% block top_body %}
<ul class="breadcrumb">
    <li><a href="{{path('mycp_backend_front')}}">Administración</a> <span class="divider">/</span></li>
    <li class="active">Logs</li>
</ul>
{% endblock %}
{% block content %}
<h2>Logs</h2>
<hr/>
{% for message in app.session.flashbag.get('message_error_local') %}
<div class="alert alert-error">{{ message }}</div>
{% endfor %}
{% if count_logs == 0 and msg_session==0 and post['submit'] is defined %}<div class="alert alert-error">No hay Logs disponibles.</div>{% endif %}
<form id="form_logs" action="{{ path('mycp_list_logs') }}" method="POST" >
<div class="well well-small">
    <div class="row-fluid">
        <div class="span2">
            <label>Rol:</label>
            <select class="input-block-level" name="role" id="role"/>
            {% render 'mycpBundle:BackendLog:get_roles' with{'selected':post} %}
            </select>
        </div>
        <div class="span2">
            <label>Usuario:</label>
            <select class="input-block-level" name="user" id="user"/>
            {% render 'mycpBundle:BackendLog:get_users' with{'selected':post,'role': post['role']} %}
            </select>
        </div>
        <div class="span2">
            <label>Módulo:</label>
            <select class="input-block-level" name="module" id="module"/>
            {% render 'mycpBundle:BackendLog:get_modules' with{'selected':post} %}
            </select>
        </div>
        <div class="span2">
            <label>Fecha inicio:</label>
            <input id="from_date" value="{% if post['from_date'] is defined %}{{ post['from_date'] }}{% endif %}" class="input-block-level datepicker" name="from_date" type="text"/>
        </div>
        <div class="span2">
            <label>Fecha fin:</label>
            <input id="to_date" value="{% if post['to_date'] is defined %}{{ post['to_date'] }}{% endif %}" class="input-block-level datepicker" name="to_date" type="text"/>
        </div>
        <div class="span2"><label>&nbsp;</label><a href="javascript:action_submit();" class="btn btn-block btn-success"><i class="icon-list-alt icon-white"></i> Informe log</a></div>
    </div>
</div>
</form>

<div class="row-fluid">
    <div class="span12">
        <textarea class="input-block-level" style="height: 300px; font-size: 12px">{% if logs %}Logs{{'\n'}}-----------------------------------------------------{{'\n'}}{%endif%}{% for log in logs %}- {{log.getLogDescription}} {% if log.getLogDescription != 'Login'%}in module{% else %}into {% endif %}({% if log.getLogModule==0 %}MyCp{% endif %}{% if log.getLogModule==1 %}Destination{% endif %}{% if log.getLogModule==2 %}FAQ{% endif %}{% if log.getLogModule==3 %}Album{% endif %}{% if log.getLogModule==4 %}Ownership{% endif %}{% if log.getLogModule==5 %}Currency{% endif %}{% if log.getLogModule==6 %}Language{% endif %}{% if log.getLogModule==7 %}Reservation{% endif %}{% if log.getLogModule==8 %}User{% endif %}{% if log.getLogModule==9 %}General Information{% endif %}) by {{log.getlogUser.getUserName}} in date {{ log.getLogDate|date("d/m/Y") }} on time {{ log.getLogTime }}{{'\n'}}{% endfor %}</textarea>
    </div>
</div>
<div class="row-fluid">
    <div class="span9"></div>
    <div class="span3"><a href="{{ path('mycp_delete_logs') }}" class="btn btn-block btn-danger"><i class="icon-remove icon-white"></i>Limpiar informes de logs</a></div>
</div>
<link href="{{ asset('bundles/mycp/css/datepicker.css') }}" rel="stylesheet" type="text/css" />
<script src="{{ asset('bundles/mycp/js/bootstrap-datepicker.js') }}" type="text/javascript"></script>
<script type="text/javascript" src="{{ asset('bundles/mycp/js/bootstrap-datepicker.es.js') }}" charset="UTF-8"></script>
<script type="text/javascript">
    url = "{{ path('mycp_get_users_logs',{ 'selected':'', 'role':''}) }}",
            $('#role').change(function(){
                role = $('#role').val();
                array_role=role.split('_')
                selected = $('#user').val();
                if(selected=='')
                    selected='null';
                if(role!='')
                {
                    $('#user').html('<option value="">Cargando...</option>');
                    $.ajax({
                        type:"POST",
                        url:url+ selected + '/'+ role,
                        success:function (msg) {
                            $('#user').html(msg);
                        }
                    });
                }
            });

    $('#user').change(function(){
        role_user=$('#user option:selected').attr('class');
        $("#role option[value="+ role_user +"]").attr("selected",true);
    });

    $('.datepicker').datepicker({
        format: 'dd/mm/yyyy',
        todayBtn: 'linked',
        language: 'es'
    });

    function action_submit()
    {
        $('#form_logs').submit();
    }
</script>

{% endblock %}
