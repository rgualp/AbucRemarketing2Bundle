<h2>Detalles de Reserva: CAS.{{reservation.getGenResOwnId.getOwnMcpCode}}</h2>
<button type="button" onclick="javascript:close_tab({{ reservation.getGenResId }})" style="margin-top: -6px" class="close_tab pull-right btn btn-mini btn-danger"><i class="icon-white icon-remove"></i> Cerrar pestaña</button>
<hr/>
<div class="row-fluid">
<div class="span6">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#reservas" data-toggle="tab">Info: Casa</a>
        </li>
    </ul>
    <table class="table table-striped" style="font-size: 12px">
        <tr>
            <td><b>ID Casa:</b></td>
            <td>{{ reservation.getGenResOwnId.getOwnMcpCode }} {{ reservation.getGenResOwnId.getOwnName }}</td>
        </tr>
        <tr>
            <td><b>Tipo de propiedad:</b></td>
            <td>{{ reservation.getGenResOwnId.getOwnType }}</td>
        </tr>
        <tr>
            <td><b>Propietario:</b></td>
            <td>{{ reservation.getGenResOwnId.getOwnHomeowner1 }}</td>
        </tr>
        <tr>
            <td><b>Dirección:</b></td>
            <td>{{ reservation.getGenResOwnId.getOwnAddressStreet }} {{ reservation.getGenResOwnId.getOwnAddressNumber }} e/ {{ reservation.getGenResOwnId.getOwnAddressBetweenStreet1 }} y {{ reservation.getGenResOwnId.getOwnAddressBetweenStreet2 }} {{ reservation.getGenResOwnId.getOwnAddressMunicipality }}</td>
        </tr>
        <tr>
            <td><b>Teléfono:</b></td>
            <td>{{ reservation.getGenResOwnId.getOwnPhoneCode }} {{ reservation.getGenResOwnId.getOwnPhoneNumber }}</td>
        </tr>
    </table>
</div>
<div class="span6">
    <ul class="nav nav-tabs">
        <li class="active">
            <a href="#reservas" data-toggle="tab">Info: Cliente Tourist</a>
        </li>
    </ul>
    <table class="table table-striped" style="font-size: 12px">
        <tr>
            <td><b>Nombre:</b></td>
            <td colspan="3">{{ reservation.getGenResUserId.getUserUserName }} {{ reservation.getGenResUserId.getUserLastName }}</td>
        </tr>
        <tr>
            <td><b>Dirección:</b></td>
            <td colspan="3">{{ reservation.getGenResUserId.getUserAddress }}</td>
        </tr>
        <tr>
            <td><b>Ciudad:</b></td>
            <td>{{ reservation.getGenResUserId.getUserCity }}</td>
            <td><b>País:</b></td>
            <td>{{ reservation.getGenResUserId.getUserCountry }}</td>
        </tr>
        <tr>
            <td><b>Email:</b></td>
            <td colspan="3">{{ reservation.getGenResUserId.getUserEmail }}</td>
        </tr>
        <tr>
            <td><b>Idioma:</b></td>
            <td>{{ user[0].getUserTouristLanguage.getLangName }}</td>
            <td><b>Moneda:</b></td>
            <td>{{ user[0].getUserTouristCurrency.getCurrName }}</td>
        </tr>
    </table>
</div>
<div class="row-fluid">
    <div class="span12">
        <ul class="nav nav-tabs">
            <li class="active">
                <a href="#reservas" data-toggle="tab">Servicio: Alojamiento</a>
            </li>
        </ul>
        <table class="table table-striped" style="font-size: 12px">
            <thead>
            <tr>
                <th>Habitación</th>
                <th>Adultos</th>
                <th>Niños</th>
                <th>Entrada</th>
                <th>Salida</th>
                <th>Noches</th>
                <th>Precio</th>
                <th>Comisión</th>
                <th>Total</th>
                <th>Estado</th>
            </tr>
            </thead>
            {% set flag = 0 %}
            {% set total_adults = 0 %}
            {% set total_childrens = 0 %}
            {% set total_nights = 0 %}
            {% set total_price_own_res = 0%}
            {% for reservation_rooms in reservations%}
            {% set total_adults = total_adults +  reservation_rooms.getOwnResCountAdults %}
            {% set total_childrens = total_childrens +  reservation_rooms.getOwnResCountChildrens %}
            {% set total_nights = total_nights +  nights[loop.index0] %}
            {% set total_price_own_res = total_price_own_res +   nights[loop.index0] * reservation_rooms.getOwnResNightPrice %}

            <tr>
                {% set res_type ='' %}
                {% if reservation_rooms.getOwnResRoomType %}
                {% set res_type = reservation_rooms.getOwnResRoomType %}
                {% else %}
                {% set res_type = rooms[flag].getRoomType %}
                {% endif %}
                <td><select name="service_room_type_{{reservation_rooms.getOwnResId}}" class="input-block-level">
                    {% if post['service_room_type_'~reservation_rooms.getOwnResId] is defined %}{% set res_type = post['service_room_type_'~reservation_rooms.getOwnResId] %}{% endif %}
                    {{ render(controller('mycpBundle:BackendOwnership:get_room_type_list', {'post': {'service_room_type':res_type, 'not_blank':1},'id':0})) }}
                </select></td>
                <td><select name="service_room_count_adults_{{reservation_rooms.getOwnResId}}" class="input-block-level">
                    {% if post['service_room_count_adults_'~reservation_rooms.getOwnResId] is defined %}
                        {{ render(controller('mycpBundle:BackendReservation:get_numeric_list', {'post': {'selected':post['service_room_count_adults_'~reservation_rooms.getOwnResId]}})) }}
                    {% else %}
                        {{ render(controller('mycpBundle:BackendReservation:get_numeric_list', {'post': {'selected':reservation_rooms.getOwnResCountAdults}})) }}
                    {% endif %}
                </select></td>
                <td><select name="service_room_count_childrens_{{reservation_rooms.getOwnResId}}" class="input-block-level">
                    {% if post['service_room_count_childrens_'~reservation_rooms.getOwnResId] is defined %}
                        {{ render(controller('mycpBundle:BackendReservation:get_numeric_list_0', {'post': {'selected':post['service_room_count_childrens_'~reservation_rooms.getOwnResId]}})) }}
                    {% else %}
                        {{ render(controller('mycpBundle:BackendReservation:get_numeric_list_0', {'post': {'selected':reservation_rooms.getOwnResCountChildrens}})) }}
                    {% endif %}
                </select></td>
                <td>{{ reservation.getGenResFromDate | date("d/m/Y") }}</td>
                <td>{{ reservation.getGenResToDate | date("d/m/Y") }}</td>
                <td>{{ nights[loop.index0] }}</td>
                <td style="width: 7%">
                    {% set price_own_res =0%}

                    {% if post['service_room_price_'~reservation_rooms.getOwnResId] is defined %}
                    {% set price_own_res=post['service_room_price_'~reservation_rooms.getOwnResId] %}
                    {% else %}
                    {% set price_own_res=reservation_rooms.getOwnResNightPrice %}
                    {% endif %}
                    <input type="text" class="price_offer input-block-level" value="{{ price_own_res }}" name="service_room_price_{{reservation_rooms.getOwnResId}}"/>
                </td>
                <td>{{ reservation.genResOwnId.getOwnCommissionPercent }}%</td>
                <td>{{ nights[loop.index0] * price_own_res }}CUC</td>
                <td>
                    <select class="input-block-level" name="service_own_res_status_{{reservation_rooms.getOwnResId}}">
                        {% if post['service_own_res_status_'~reservation_rooms.getOwnResId] is defined %}
                            {{ render(controller('mycpBundle:BackendReservation:get_reservation_status', {'post': {'selected':post['service_own_res_status_'~reservation_rooms.getOwnResId]}})) }}
                        {% else %}
                            {{ render(controller('mycpBundle:BackendReservation:get_reservation_status', {'post': {'selected':reservation_rooms.getOwnResStatus}})) }}
                        {% endif %}
                    </select>
                </td>
            </tr>
            {% set flag = flag + 1%}
            {% endfor %}
        </table>
    </div>
</div>
<ul class="nav nav-tabs">
    <li class="active">
        <a href="#reservas" data-toggle="tab">Resumen de Reserva</a>
    </li>
</ul>
<table class="table" style="font-size: 12px;">
    <thead>
    <tr>
        <th>Habitación</th>
        <th>Adultos</th>
        <th>Niños</th>
        <th>Noches</th>
        <th>Precio Total</th>
        <th>Prepago</th>
        <th>Pago en casa</th>
        <th>T. de Crédito</th>
        <th style="text-align: right">Anticipo total a pagar</th>
    </tr>
    </thead>

    <tr>
        <td>{{ reservations|length }}</td>
        <td>{{ total_adults }}</td>
        <td>{{ total_childrens }}</td>
        <td>{{ total_nights }}</td>
        <td>{{total_price_own_res}} CUC</td>
        <td>{{ total_price_own_res * reservations[0].getOwnResGenResId.getGenResOwnId.getOwnCommissionPercent / 100}} CUC</td>
        <td>{{total_price_own_res - (total_price_own_res * reservations[0].getOwnResGenResId.getGenResOwnId.getOwnCommissionPercent / 100)}} CUC</td>
        <td>{%if total_price_own_res%}{{configuration_service_fee}} CUC{%else%} - {%endif%}</td>
        <td style="text-align: right"><b>{{(total_price_own_res * reservations[0].getOwnResGenResId.getGenResOwnId.getOwnCommissionPercent / 100) + ((total_price_own_res)?configuration_service_fee: 0)}}CUC ({{((total_price_own_res * reservations[0].getOwnResGenResId.getGenResOwnId.getOwnCommissionPercent / 100) + ((total_price_own_res)?configuration_service_fee: 0)) * user[0].getUserTouristCurrency.getCurrCucChange }} {{ user[0].getUserTouristCurrency.getCurrCode|upper }})</b></td>
    </tr>
</table>


</div>