<?php

namespace MyCp\mycpBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * ownerAccommodationRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ownerAccommodationRepository extends EntityRepository
{
    public function getMainOwner($idAccommodation)
    {
        $em = $this->getEntityManager();
        $qb = $em->createQueryBuilder();

        $qb->select('oa')
            ->from("mycpBundle:ownerAccommodation", "oa")
            ->join("oa.owner", "o")
            ->join("oa.accommodation", "ac")
            ->where("ac.own_id = :accommodationId")
            ->andWhere("o.main = true")
            ->setParameter("accommodationId", $idAccommodation)
            ->setMaxResults(1)
            ;

        return $qb->getQuery()->getResult();

    }
}
