{% set formFilter = form_search_booking_reserved.createView() %}
<div class="ibox card">
    <div class="ibox-title card">
        <span class="title-card">{{ "dashboard.booking.reserved" | trans }}</span>

        <div class="ibox-tools">
            <a class="collapse-link">
                <i class="fa fa-chevron-up"></i>
            </a>
            <a class="close-link">
                <i class="fa fa-times"></i>
            </a>
        </div>
    </div>
    <div class="ibox-content card">
        <form id="form-booking-reserved" class="filter-form">
            <div class="row">
                <div class="col-lg-1 field-filter">
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon fa-letter">CAS</span>
                            {{ form_widget(formFilter.cas, { 'attr': {'placeholder': 'booking.placeholder.cas'|trans, 'title':'booking.title.cas'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control' }}) }}
                        </div>
                    </div>
                </div>
                <div class="col-lg-1 field-filter">
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-qrcode"></i></span>
                            {{ form_widget(formFilter.booking_code, { 'attr': {'placeholder': 'booking.placeholder.code'|trans, 'title':'booking.title.code'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control' }}) }}
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 field-filter">
                    <div class="form-group">
                        <div class="input-group">
                            <span class="input-group-addon"><i class="fa fa-male"></i></span>
                            {{ form_widget(formFilter.client_dates, { 'attr': {'placeholder': 'booking.placeholder.client_dates'|trans, 'title':'booking.title.client_dates'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control' }}) }}
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 field-filter">
                    <div class="form-group">
                        <div class="input-group date">
                            {{ form_widget(formFilter.from, { 'attr': {'placeholder': 'booking.placeholder.from'|trans, 'title':'booking.title.from'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control' }}) }}
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 field-filter">
                    <div class="form-group">
                        <div class="input-group date">
                            {{ form_widget(formFilter.to, { 'attr': {'placeholder': 'booking.placeholder.to'|trans, 'title':'booking.title.to'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control' }}) }}
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
                <div class="col-lg-2 field-filter">
                    <div class="form-group">
                        {{ form_widget(formFilter.destination, { 'attr': {'data-placeholder': 'booking.placeholder.destination'|trans, 'title':'booking.title.destination'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control chosen-select-deselect' }}) }}
                    </div>
                </div>
                <div class="col-lg-2 field-filter">
                    <div class="form-group">
                        <div class="input-group date">
                            {{ form_widget(formFilter.booking_date, { 'attr': {'placeholder': 'booking.placeholder.booking_date'|trans, 'title':'booking.title.booking_date'|trans, 'data-toggle':'tooltip', 'data-container':'body', 'class':'form-control' }}) }}
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-xs-4"></div>
                <div class="col-xs-4"></div>
                <div class="col-xs-4 field-filter">
                    <div class="btn-group pull-right m-t-n-xs"><a class="btn btn-sm btn-search" onClick="filterReservedAction(this)"> {{ 'btn.search' | trans }} </a></div>
                    <div class="btn-group pull-right m-t-n-xs" style="margin-right: 4px"><a class="btn btn-sm btn-search" onClick="clearReservedAction(this)"> {{ 'btn.clear' | trans }} </a></div>
                </div>
            </div>
        </form>

        <div class="row" style="margin-top: 10px">
            <div class="col-sm-12" style="padding-left: 4px; padding-right: 4px;">
                <div class="ibox">
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table id="table-booking-reserved" class="table table-striped table-bordered table-hover  dataTable " role="grid" aria-describedby="editable_info">
                                <thead>
                                <tr role="row" class="hide">
                                    <th>{{ 'booking.title.name' | trans }}</th>
                                </tr>
                                </thead>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var oTableReserved = '';

    $(document).ready(function () {
        oTableReserved = $('#table-booking-reserved').DataTable({
            "bServerSide": true,
            "bFilter": false,
            "bLengthChange": false,
            "scrollX": false,
            "ajax": {
                "url": "{{ path('partner_dashboard_booking_list_reserved') }}",
                data: function (params) {
                    var inputs = $("#form-booking-reserved input,select");
                    inputs.each(function () {
                        var input = $(this);
                        var val = input.val();
                        var name = input.attr('name');
                        if (val && val != '' && name && name != '') {
                            params[input.attr('name')] = val;
                        }
                    });
                }
            },
            "aoColumnDefs": [
                {
                    "orderable": false,
                    "mData": null,
                    "aTargets": [0],
                    "mRender": function (data, type, full) {
                        var rooms = '';
                        var totalPrice = 0;
                        var booking_code ='';
                        var date = '';
                        for(var i = 0; i < data.rooms.length; i++){
                            var room = data.rooms[i];
                            totalPrice += room.totalPrice;
                            booking_code = room.booking.code;
                            date= room.booking.date;
                        }
                        rooms += '<em class="rt">Precio Total:</em> <span class="rst">' + totalPrice + '</span> ' +
                                 '<em class="rt">Código booking:</em> <span class="rst">' + booking_code + '</span> ' +
                                 '<em class="rt">Fecha pago:</em> <span class="rst">' + date + '</span> ' ;

                        var html = '<div class="row"> ' +
                                '<div class="col-xs-12"> ' +
                                '<em class="rt">CAS:</em> <span class="rst">' + data.cas + '</span> ' +
                                '<em class="rt">Llegada:</em> <span class="rst">' + data.from + '</span> ' +
                                '<em class="rt">Salida:</em> <span class="rst">' + data.to + '</span> ' +
                                '<em class="rt">Código:</em> <span class="rst">' + data.own_mcp_code + '</span> ' +
                                '<em class="rt">Casa:</em> <span class="rst">' + data.own_name + '</span> ' +
                                '<em class="rt">Destino:</em> <span class="rst">' + data.destination + '</span> ' +
                                rooms
                        '</div> ' +
                        '</div>';
                        return html;
                    }
                }
            ],
            "columns": [
                {"data": 'data'}
            ],
            fnDrawCallback: function() {
                $("#table-booking-reserved thead").remove();
            }
        });
    });

    function filterReservedAction() {
        oTableReserved.ajax.reload();
    }

    function clearReservedAction() {
        var inputs = $("#form-booking-reserved input,select");
        inputs.each(function () {
            var input = $(this);
            var val = input.val();
            var name = input.attr('name');
            if (val && val != '' && name && name != '') {
                input.val('');
                if (input.hasClass('chosen-select-deselect')) {
                    input.chosen().trigger("chosen:updated");
                }
            }
        });

        oTableReserved.ajax.reload();
    }
</script>