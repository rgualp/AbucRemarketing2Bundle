{% extends 'MyCpCasaModuleBundle::layout_dashboard.html.twig' %}

{% block title %}Calendario{% endblock title %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('/bundles/mycpcasamodule/css/plugins/fullcalendar/fullcalendar.css') }}">
    <link rel="stylesheet" href="{{ asset('/bundles/mycp/css/datepicker.css') }}">
{% endblock %}
{% block content %}
    <div class="row row-eq-height">
        <div class="col-md-9 white-bg">
            <div class="row">
                <div class="col-sm-1">
                    <img src="{{ asset('bundles/mycpcasamodule/img/Disponibilidad.png') }}" class="img-title-step m-t-10" style="margin-left: 20px;">
                </div>
                <div class="col-sm-11">
                    <h2 class="font-blue">Disponibilidad</h2>
                </div>
            </div>
     <div class="col-sm-12 m-t-20">
         <div class="col-sm-9">
             <div class="tabbable font-black tab-mcp">
                 <ul id="nav-tabs-dispo" class="nav nav-tabs mcp">
                     {% for room in ownership.ownRooms %}
                         <li id="nav{{ room.roomId }}" class="{% if loop.first %}active{% endif %}">
                             <a href="#tab{{ room.roomId }}" data-toggle="tab" data-id="{{ room.roomId }}">Habitación {{ room.roomNum }}</a>
                         </li>
                      {% endfor %}
                 </ul>
                 <div id="tab-content-dispo" class="tab-content">
                     {% for room in ownership.ownRooms %}
                         <div id="tab{{ room.roomId }}" class="tab-pane {% if loop.first %}active{% endif %}" style="padding: 15px;">
                             {#<h3>Habitación {{ room.roomNum }}</h3>#}
                             <div class="row">
                             <div class="col-md-12">
                         <div id="calendar{{ room.roomId }}" class="fullcalendar">

                         </div>
                             </div>
                         </div>
                             <div class="row m-t-20 m-l-25">
                                 <div class="col-md-4">

                                    <div class="circle circle-warning"></div> <span>{{ 'No disponible'|upper }}</span>
                                 </div>
                                 <div class="col-md-4">
                                    <div class="circle circle-info"></div> <span>{{ 'Reservada MYCP'|upper }}</span>
                                 </div>
                                 <div class="col-md-4">
                                    <div class="circle circle-danger"></div> <span>{{ 'Cancelada por cliente'|upper }}</span>
                                 </div>

                             </div>
                         </div>
                     {% endfor %}
                 </div>
             </div>
         </div>
         <div class="col-sm-3">
             <h3 class="font-blue">Gestione la disponibilidad de sus habitaciones</h3>
             <div class="bg-gray m-t-20 row font-black">
                 <form class="form-horizontal" method="post" action="">
                     <div class="form-group row">
                         <label class="control-label">Habitación</label>
                         <div class="row">
                             <div class="col-sm-2"><i class="glyphicons keys form-icon pull-right"></i></div>
                             <div class="col-sm-10">
                                 <select class="form-control" name="room" id="">
                                     {% for room in ownership.ownRooms %}
                                     <option value="{{ room.roomId }}">
                                         Habitación  {{ room.roomNum }}
                                     </option>
                                     {% endfor %}
                                     </select>
                                      </div>
                             </div>
                         </div>
                     <div class="form-group row">
                         <label class="control-label">Desde</label>
                         <div class="row">
                             <div class="col-sm-2"><i class="glyphicons calendar form-icon pull-right"></i></div>
                             <div class="col-sm-10">
                              <input type="text" id="date_from" name="date_from" class="form-control">
                             </div>
                             </div>
                         </div>
                     <div class="form-group row">
                         <label class="control-label">Hasta</label>
                         <div class="row">
                             <div class="col-sm-2"><i class="glyphicons calendar form-icon pull-right"></i></div>
                             <div class="col-sm-10">
                                 <input type="text" id="date_to"  name="date_to" class="form-control">
                             </div>
                         </div>
                     </div>

                     <div class="form-group row">
                         <label class="control-label">Estado</label>
                         <div class="row">
                             <div class="col-sm-2"><i class="glyphicons tag form-icon pull-right"></i></div>
                             <div class="col-sm-10">
                                 <select class="form-control" name="status" id="">
                                         <option value="0">No disponible</option>
                                         <option value="1">Disponible</option>
                                 </select>
                             </div>
                         </div>
                     </div>
                     <div class="row m-t-30 text-center">
                     <button type="submit" class="btn btn-primary dim">Guardar</button>
                     <button type="reset" class="btn btn-default dim">Cancelar</button>
                     </div>
                 </form>
             </div>
         </div>
     </div>
     </div>
        <div class="col-md-3 oneblue-bg col-content">
            <div id="help-step2-one" class="row">
                <div class="col-md-12 m-t-20">
                    <p>ingrese de manera clara la dirección de su alojamiento. Así proporcionamos al visitante referencias geográficas especificas</p>
                </div>
            </div>
            <div id="help-step2-two" class="row">
                <div class="col-md-12 m-t-40">
                    <p>especifique el destino turístico al cual pertenece su alojamiento</p>
                </div>
            </div>
            <div id="help-step2-three" class="row">
                <div class="col-md-12 m-t-40">
                    <p>usted puede ubicar su alojamiento en el mapa, o simplemente poner su dirección y el mapa le dará la opción de verificar sus datos. Haga más fácil para el cliente encontrar su alojamiento)</p>
                </div>
            </div>
            <div id="help-step2-four" class="row">
                <div class="col-md-12 m-t-40">
                    <p>especifique cuales son los idiomas que domina, a través de los cuales usted y su personal se pueden comunicar con el cliente</p>
                </div>
            </div>

        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('bundles/mycpcasamodule/js/plugins/fullcalendar/moment.min.js') }}"></script>
    <script src="{{ asset('bundles/mycpcasamodule/js/plugins/fullcalendar/fullcalendar.min.js') }}"></script>
    <script src="{{ asset('bundles/mycpcasamodule/js/plugins/fullcalendar/lang-all.js') }}"></script>
    <script src="{{ asset('bundles/mycp/js/bootstrap-datepicker.js') }}"></script>
    <script src="{{ asset('bundles/mycp/js/bootstrap-datepicker.es.js') }}"></script>
    <script type="text/javascript">
        $(document).on('ready', function(){
//            var id='';
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
               id=$(this).data('id');
                console.log(id);
                $('#calendar'+id).fullCalendar('render');
            });
          var dateTo= $('#date_to').datepicker({
              format:'dd/mm/yyyy',
              todayBtn:'linked',
              language:'es',
              autoclose: true,
              startDate: 0,
              headTemplate: '<thead>'+
              '<tr>'+
              '<th class="prev"><i class="fa fa-chevron-left"/></th>'+
              '<th colspan="5" class="switch"></th>'+
              '<th class="next"><i class="icon-arrow-right"/></th>'+
              '</tr>'+
              '</thead>',
            }).data('datepicker');
            $('#date_from').datepicker({
                format:'dd/mm/yyyy',
                todayBtn:'linked',
                language:'es',
                autoclose: true,
                startDate: 0
            }).on('changeDate', function(ev){
                var date = new Date(ev.date);
                dateTo.setStartDate(date);
                date.setDate(date.getDate() + 1);
                dateTo.setDate(date);
            });
            {% for room in ownership.ownRooms %}
            $('#calendar{{ room.roomId }}').fullCalendar({

                header: {
                    left: 'prev,next title',
//                    center: '',
                    right: 'agendaDay month,agendaWeek'
                },
                editable: false,
                droppable: false, //
                allDayDefault: true,
                lazyFetching: true,
                lang: 'es',
                'timezone': 'local',
//                'eventTimeFormat': 'h:mmt',
                eventSources: [
                    {
                        url: '{{ path('get_room_calendar') }}',
                        type: 'POST',
                        // A way to add custom filters to your event listeners
                        data: {
                            room: '{{ room.roomId }}'
                        },
                        error: function() {
                            //alert('There was an error while fetching Google Calendar!');
                            toastr.error('Ocurrió un error al cargar el calendario','Oops');
                        }
                    }
                ],
                {#events: function(start, end, timezone, callback) {#}
                    {#$.ajax({#}
                        {#url: '{{ path('get_room_calendar') }}',#}
                        {#dataType: 'json',#}
                        {#data: {#}
                            {#// our hypothetical feed requires UNIX timestamps#}
                            {#start: start.unix(),#}
                            {#end: end.unix()#}
                        {#},#}
                        {#success: function(doc) {#}
                            {#var events = [];#}
                            {#$(doc).find('event').each(function() {#}
                                {#events.push({#}
                                    {#title: $(this).attr('title'),#}
                                    {#start: $(this).attr('start') // will be parsed#}
                                {#});#}
                            {#});#}
                            {#callback(events);#}
                        {#}#}
                    {#});#}
                {#},#}
                eventRender: function(event, element, view){
//                    console.log(element);
//                    fc-day fc-widget-content fc-thu fc-future
                    var st=event.start;
//                    console.log(st._i);
                    $('td.fc-day[data-date="'+st._i+'"]').addClass(''+event.className);
                    $('td.fc-day-number[data-date="'+st._i+'"]').css('color','white');
                    element.addClass('hide');


                },
//                dayRender: function(date, cell){
//                    if (moment().diff(date,'days') > 0){
//                        cell.css("background-color","silver");
//                    }
//                },
            })
            {% endfor %}
        });
    </script>
{% endblock %}