{% extends 'FrontEndBundle:new_layout:base_filters.html.twig' %}
{% block include_javascripts_and_css %}
    {% stylesheets
    '@FrontEndBundle/Resources/public/css/plugins/ionRangeSlider/ion.rangeSlider.css'
    '@FrontEndBundle/Resources/public/css/plugins/ionRangeSlider/ion.rangeSlider.skinFlat.css'
    '@FrontEndBundle/Resources/public/js/plugins/bootstrap-select/bootstrap-select.min.css'
    '@FrontEndBundle/Resources/public/css/slider.css'
    '@FrontEndBundle/Resources/public/css/filtersv2.css'
    filter='?uglifycss'
    %}
    <link rel="stylesheet" href="{{ asset_url }}" />
    {% endstylesheets %}
    <style>
    </style>
{% endblock %}
{% block other_load_js %}
    {% javascripts
    '@FrontEndBundle/Resources/public/js/ownership.js'
    filter='?uglifyjs2'
    %}
    .script('{{ asset_url }}')
    {% endjavascripts %}
{% endblock %}

{% set desName = destination_name %}
{% block title %}
    {% if get_tagvalue_bytag('Destino ' ~ destination.desName, lang_code, 'title') == false %}
        {{ 'DESTINATION_DETAILS' | trans ({'%destinationName%': desName}) }}
    {% else %}
        {{ get_tagvalue_bytag('Destino ' ~ destination.desName, lang_code, 'title')|raw }}
    {% endif %}
{% endblock %}

{% set section = constant('\\MyCp\\mycpBundle\\Entity\\metaTag::SECTION_DESTINATIONS') %}

 {% block metas %}
     {{ get_metas('Destino ' ~ destination.desName, lang_code)|raw }}
 {% endblock metas %}

{% set main_tab = 2 %}
{% block content_nav_top_body %}
    {{"SEARCH_DESCRIPTION_MAIN_MENU" | trans}}
{% endblock %}
{% block marquesina %}{% endblock %}

{% block class_breadcrumbs %}{% endblock %}
{% block breadcrumbs %}{% endblock %}
{% block body %}
    <div class="row" id="search-container" style="width: 100%; margin:0;">
        <div class="col-sm-7 p-0" style="padding-right: 0; position: relative">
            <div id="loading" class="hidden">
                <div class="layer-loading"></div>
                <div class="loading-signal"><img class="img-circle load-icon" src="{{ asset('bundles/frontend/img/loading.gif') }}" title="{{"Loading" | trans}}" alt="{{"Loading" | trans}}"/></div>
            </div>
            {#{%if view_results != 'MAP'%}#}
            {#<div class="thumbnail" id="map" style="width:100%;height:150px;" class="google-maps"></div>#}
            {#{%endif%}#}
            {#<div  id="json_source" data-url="{{path("frontend_map_markers_ownership_callback")}}"#}
            {#data-icon-small="{{ app.request.getSchemeAndHttpHost() ~ asset('bundles/frontend/img/map_small.png') }}"#}
            {#data-icon="{{ app.request.getSchemeAndHttpHost() ~ asset('bundles/frontend/img/map_marker.png') }}"></div>#}

            {{ include('FrontEndBundle:ownership:verticalSearcherOwnershipv2.html.twig',
            {'is_within_search_results':true,
                'locale': locale, 'isDestination': true})}}
            <div class="filter accordion-body collapse" id="collapseFilters">
                <div id="filters" data-url-filter="{{ path('frontend_filter_ownership_callback') }}" data-url-statistics="{{ path('frontend_filter_statistics_ownership_callback') }}">
                    {%if check_filters is defined%}
                        {{ include('FrontEndBundle:ownership:filtersv2.html.twig',
                        {'own_statistics': own_statistics,'check_filters': check_filters}) }}
                    {%else%}
                        {{ include('FrontEndBundle:ownership:filtersv2.html.twig',
                        {'own_statistics': own_statistics}) }}
                    {%endif%}
                </div>
            </div>
            <div id="filter_upper">
                {%if check_filters is defined and check_filters | length%}

                {%endif%}
            </div>

            <div class="col-sm-12">
                <div class="modal inmodal fade" id="myModalOwnerShipCalendar" tabindex="-1" role="dialog"  aria-hidden="true"></div>
                <div class="houses-list thumbs-houses lazy-cont result_list ownerships_mosaic" id="div_result" data-current-page="{{ current_page }}" data-cant-page="{{ cant_pages }}" style="height: 400px;">

                    {#{{ include('FrontEndBundle:ownership:searchMosaicOwnershipv2.html.twig',#}
                    {#{'list': list,#}
                    {#'list_preffix': 'mosaic'#}
                    {#}) }}#}

                </div>
            </div>
        </div>
        <div class="col-sm-5 p-0">
            <div class="destination-bar-title fmap col-sm-12 clearfix" style="padding: 0;">
                <div class="col-sm-7" style="padding: 0 15px 13px;">
                    <ul class="nav" style="margin: 0">
                        <li><h1 class="h-green caecilia-roman">
                                {{ desName }}
                            </h1></li>
                        <li><a class="show-hide-description" title="{{ 'DESCRIPTION_TAB_DETAILS' | trans }}" href="#" style="font-size: 26px;margin-left: 7px; padding: 0 10px;"><i class="ion-more"></i></a></li>
                    </ul>
                </div>
                <div class="col-sm-5" style="padding: 6px 0px 7px;">
                    {#<div class="col-sm-12">#}
                        {#{{ include('FrontEndBundle:favorite:detailsFavorite.html.twig',#}
                        {#{'is_in_favorite': is_in_favorite,#}
                            {#'favorite_type': 'destination',#}
                            {#'element_id':destination.desid#}
                        {#}) }}#}
                    {#</div>#}
                    {#<div class="col-sm-12">#}
                        {#<a href="#send_to_friend_popup" title="{{ 'SEND_TO_FRIEND' | trans }}" data-toggle="modal" style="text-decoration: none">#}
                            {#<button style="margin-top: 15px" class="btn btn-default btn-block" onclick="$('#send_to_friend_popup').attr('data-email-type', 'recommend_destiny'); $('#send_to_friend_popup').attr('data-dest-prop-id', '{{ destination.getDesId }}');">#}
                                {#<img src="{{ asset('bundles/frontend/img/main_to_friend.gif') }}" alt="{{ "TELL_A_FRIEND" | trans }}">{{ "TELL_A_FRIEND" | trans }}#}
                            {#</button>#}
                        {#</a>#}
                    {#</div>#}
                </div>
            </div>
            <div class="thumbnail" id="search_map" style="width:100%; border-radius: 0;" class="google-maps"></div>
            <div  id="json_search_source" data-url="{{path("frontend_map_markers_ownership_callback")}}"
                  data-icon-small="{{ app.request.getSchemeAndHttpHost() ~ asset('bundles/frontend/img/map_small.png') }}"
                  data-icon="{{ app.request.getSchemeAndHttpHost() ~ asset('bundles/frontend/img/map_marker.png') }}"></div>

            {% if gallery_photos | length %}
                <div id="poput-description" class="clearfix dhide">
                    {% set img = "" %}
                    {% for photo in  gallery_photos%}
                        {% if loop.first %}
                            {% set img = asset('uploads/destinationImages/'~photo)  %}
                        {% endif %}
                    {%endfor%}
                    <div class="images-destination" style="background-image: url('{{ img }}');">
                        <div class="destination-bar-title col-sm-12 clearfix">
                            <div class="col-sm-7" style="padding: 0px;">
                                <ul class="nav" style="margin: 0">
                                    <li><h2 class="h-green caecilia-roman">
                                            {{ desName }}
                                        </h2></li>
                                    <li><a class="show-hide-description" title="{{ 'MAP_VIEW' | trans }}" href="#" style="font-size: 26px;margin-left: 7px; padding: 0 10px;"><i class="ion-ios-location"></i></a></li>
                                </ul>
                            </div>
                            <div class="col-sm-5" style="padding: 6px 0px 7px;">
                                <div class="col-sm-12">
                                    {{ include('FrontEndBundle:favorite:detailsFavorite.html.twig',
                                    {'is_in_favorite': is_in_favorite,
                                        'favorite_type': 'destination',
                                        'element_id':destination.desid
                                    }) }}
                                </div>
                                <div class="col-sm-12">
                                    <a href="#send_to_friend_popup" title="{{ 'SEND_TO_FRIEND' | trans }}" data-toggle="modal" style="text-decoration: none">
                                        <button style="margin-top: 15px" class="btn btn-default btn-block" onclick="$('#send_to_friend_popup').attr('data-email-type', 'recommend_destiny'); $('#send_to_friend_popup').attr('data-dest-prop-id', '{{ destination.getDesId }}');">
                                            <img src="{{ asset('bundles/frontend/img/main_to_friend.gif') }}" title="{{ "TELL_A_FRIEND" | trans }}" alt="{{ "TELL_A_FRIEND" | trans }}">{{ "TELL_A_FRIEND" | trans }}
                                        </button>
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="p-description">
                            <p>{{ description | raw }}</p>
                        </div>

                    </div>
                </div>
            {% endif %}
        </div>
    </div>
    {% block marquesina_js %}{% endblock %}
    {% block javascripts %}
        <script>
            var otherpage = {{ current_page }};

            function initJSTwig() {
                $('.bs-select').selectpicker({
                    iconBase: 'fa',
                    tickIcon: 'fa-check'
                });

                var h = $(window).height() - 24 - $('#top-menu-cont').height()-$('.filters-container').height();
                $(".destination-bar-title").css("height", $('.filters-container').height() + 14 +"px");

                $('#div_result').slimScroll({
                    height: h+'px',
                    start: 'top',
                    allowPageScroll: true
                }).bind('slimscrolling', function(e, pos){
                    if ( pos >= $('#div_result')[0].scrollHeight - $('#div_result').height() ){
                        otherpage++;
                        if ( parseInt(otherpage) <= parseInt($('#div_result').attr("data-cant-page")) ){
                            $('#div_result')[0].scrollTop = pos - 200;
                            research(otherpage);
                        }
                    }
                });

                var h1 = $('#search-container').height() - $(".destination-bar-title.fmap").height();

                $('#search_map').css('height',h1+'px');


                $('[data-submenu]').submenupicker();

                $(".show-more-footer a").click(function (e) {
                    e.preventDefault();
                    $(".show-more-footer, footer.footer-static").toggleClass("showFooter");
                });

                $("iframe").css("position", "fixed");

                jQuery("#priceFilter").slider({});

                $('#poput-description .p-description p').slimScroll({
                    height: '200px',
                    start: 'top',
                    allowPageScroll: true
                });

                $(".show-hide-description").on("click", function (e) {
                    e.preventDefault();
                    $("#poput-description").toggleClass("dhide");
                })


            }
        </script>
        {{ include('FrontEndBundle:script:script.html.twig') }}
    {% endblock %}
{% endblock %}
{#{% block go_up %}#}
    {#<div class="show-more-footer text-center"><a title="{{"FOOTER" | trans }}" href="#"><i class="ion-more"></i></a></div>#}
{#{% endblock %}#}
{% block forsearch %}{{ 'footer-static' }}{% endblock %}
