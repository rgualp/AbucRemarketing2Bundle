{% extends 'frontEndBundle:layout:base.html.twig' %}
{% block title %}
{{"POPULAR_DESTINATIONS_PAGE_TITLE" | trans}}
{% endblock %}

{% set main_tab = 2 %}
{% block content_nav_top_body %}
destinos
{% endblock %}

{% block body %}
<ul class="breadcrumb">
    <li><a href="{{ path('frontend_welcome') }}" title="{{"GO_HOME_TITLE" | trans}}">{{"HOME_MAIN_MENU" | trans}}</a> <span class="divider">»</span></li>
    <li><a href="{{ path('frontend_details_ownership',{'owner_id':ownership.getOwnId}) }}" title="">{{ ownership.getOwnName }}</a> <span class="divider">»</span></li>
    <li class="active">Reservation</li>
</ul>
<div class="row-fluid">
    <h4 class="head_1">{{ ownership.getOwnName }} (Detalles de Reservación)</h4>
    <div class="thumbnail" style="border-radius: 8px; padding: 3px 0 0 0">
        <table  class="table table_striped_vertical table-hover">
            <thead>
            <tr>
                <th>Fecha entrada</th>
                <th>Fecha salida</th>
                <th>Habitación</th>
                <th>Huésp.</th>
                <th>Adultos</th>
                <th>Niños</th>
                <th>Estancia</th>
                <th>Total</th>
                <th></th>
            </tr>
            </thead>
            <tbody>

            {% for room in array_rooms %}
            <tr id="tr_{{room.getRoomId}}">
                <td class="grey">{{from_date |replace('&','/')}}</td>
                <td>{{to_date|replace('&','/')}}</td>
                <td class="grey">
                    {{room.getRoomType}}
                </td>
                <td>
                    {{guests[loop.index0] + kids[loop.index0]}}
                </td>
                <td class="grey">
                    {{guests[loop.index0]}}
                </td>
                <td>
                    {{kids[loop.index0]}}
                </td>
                <td class="grey">
                    {{ array_dates| length - 1}} noches
                </td>
                <td class="">
                    {% if array_rooms[loop.index0].getRoomType == 'Habitación Triple'%}
                    {{app.session.get('curr_symbol')}}{{(rooms_price[loop.index0]  + (10*app.session.get('curr_rate') == null ? 1 : app.session.get('curr_rate'))) * (app.session.get('curr_rate') == null ? 1 : app.session.get('curr_rate')) }}
                    {% else %}
                    {{app.session.get('curr_symbol')}}{{rooms_price[loop.index0] * (app.session.get('curr_rate') == null ? 1 : app.session.get('curr_rate'))}}
                    {% endif %}
                </td>
                <td class="table_delete">
                    <button data="{{array_rooms[loop.index0].getRoomId}}" class="table_delete">&nbsp;</button>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        <div class="table_striped_vertical_foot">
            <div class="row-fluid">
            <div class="span6">Total</div>
            <div class="span6" style="text-align: right">{{app.session.get('curr_symbol')}}{{total_price * (app.session.get('curr_rate') == null ? 1 : app.session.get('curr_rate'))}}</div>
            </div>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span6"></div>
        <div class="span6" style="text-align: right">
            <label style="font-size: 10px;">Las Habitaciones triples tienen un recargo de {{10 * (app.session.get('curr_rate') == null ? 1 : app.session.get('curr_rate'))}} {{app.session.get('curr_symbol') == null ? "$" : app.session.get('curr_acronym')| upper}}</label>
            <a href="{{ path('frontend_search_ownership',{'text':'null', 'arrival':'null','departure':'null','guests':'1', 'rooms':'1'})}}" class="btn mycp_btn_blue mycp_btn">Continuar buscando</a>&nbsp;&nbsp;
            <a id="send_reservation" href="{{ path('frontend_review_confirm_reservation',{'id_ownership':ownership.getOwnId,'from_date':from_date,'to_date':to_date,'ids_rooms':rooms_string,'count_guests':guests_string,'count_kids':kids_string,'rooms_price':rooms_price_string,'total_price':total_price}) }}" class="btn mycp_btn_green mycp_btn">Consultar disponibilidad</a>
        </div>
    </div>
    <input name="ids_rooms" class="hidden" value="{{rooms_string}}"/>
    <input name="guests" class="hidden" value="{{ guests_string }}"/>
    <input name="ownership" class="hidden" value="{{ownership.getOwnId}}"/>
    <input name="from_date" class="hidden" value="{{from_date}}"/>
    <input name="to_date" class="hidden" value="{{to_date}}"/>
    <br/>
</div>
<div class="tiny modal fade hide" id="confirmation_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <p>¿Confirma que desea eliminar esta reservación?</p>
        <br/>
        <div class="row-fluid">
            <div class="span6"><button data-dismiss="modal" class="btn btn-block mycp_btn_grey mycp_btn">Cancelar</button></div>
            <div class="span6"><button id="delete_button" class="btn btn-block mycp_btn_orange mycp_btn">Eliminar</button></div>
        </div>
    </div>
</div>
<div class="tiny modal fade hide" id="messaje_modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-body">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <p>Debe disponer de al menos una habitación.</p>
        <br/>
        <div class="row-fluid">
            <div class="span3"></div>
            <div class="span6"><button data-dismiss="modal" class="btn btn-block mycp_btn_orange mycp_btn">Aceptar</button></div>
            <div class="span3"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $('.table_delete').click(function(){
        $('#confirmation_modal').modal('show');
        $('#delete_button').attr('data',$(this).attr('data'));
    });
    $('#delete_button').click(function(){
        new_url='';
        room=$(this).attr('data');
        url=$('#send_reservation').attr('href');
        array_url=url.split('/');
        rooms=array_url[array_url.length-4];

        if(rooms.split('%26').length==2)
        {
            $('#confirmation_modal').modal('hide');
            $('#messaje_modal').modal('show');
        }
        else
        {
            rooms=rooms.replace('%26'+room,'');
            array_url[array_url.length-4]=rooms;
            for( a=0; a < array_url.length; a++ )
            {
                new_url=new_url+'/'+array_url[a];
            }
            new_url=new_url.replace('//','/');
            $('#send_reservation').attr('href',new_url);
            $('#confirmation_modal').modal('hide');
            $('#tr_'+room).remove();
        }


    });
</script>
{% endblock %}